[main_keras.py::train] Number of classes: 1
[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000
[main_keras.py::train] Model created with input size: (128, 256)

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.09037328 0.91180646 0.10344285 0.17637146]]

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.03690691 0.34772122 0.06372872 0.12479049]
 [0.         0.         0.61404896 0.35199946 0.05958945 0.12223467]]
[main_keras.py::data_generator] Target shape: (3, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.97042054 0.21456407 0.05666666 0.10661879]
 [0.         0.         0.09249413 0.2612098  0.05941349 0.11546978]
 [0.         0.         0.9841166  0.8250787  0.03176678 0.07630163]]
[main_keras.py::data_generator] Batch samples shape: (4, 128, 256, 3)
[main_keras.py::data_generator] Batch targets shape: (6, 6)
[main_keras.py::data_generator] Batch shapes shape: (4, 3, 2)

--- [main_keras.py::train] KERAS BATCH 0 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.000/1.000
[main_keras.py::train] Targets shape: (6, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 6
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.26630247 0.24424946 0.08864759 0.15912843]]
[main_keras.py::train] Target sample: [[1.         0.         0.03690691 0.34772122 0.06372872 0.12479049]
 [1.         0.         0.61404896 0.35199946 0.05958945 0.12223467]
 [3.         0.         0.97042054 0.21456407 0.05666666 0.10661879]
 [3.         0.         0.09249413 0.2612098  0.05941349 0.11546978]
 [3.         0.         0.9841166  0.8250787  0.03176678 0.07630163]]
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -10.278283/6.461700
[main_keras.py::train] Output mean/std: 0.931510/1.299738

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.047163
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.747403, max: 0.044295
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.044294923543930054
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.8815989044629333e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.046455927193164825
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.006008, max: 0.046482
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.004237, max: 0.044295
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.066727
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.981915
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.334151
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.223403
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.046456
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.981915
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.334151
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.223403
[utils/util.py::ComputeLoss.__call__] Total loss: 1.539468
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 1.539468
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [main_keras.py::train] KERAS BATCH 1 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.298/1.000
[main_keras.py::train] Targets shape: (4, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 4
[main_keras.py::train] Target sample: [[1.         0.         0.07507877 0.35559845 0.08764354 0.16708472]
 [1.         0.         0.21003762 0.27585348 0.09113713 0.11392139]
 [3.         0.         0.76261616 0.38455945 0.12219959 0.21761712]]
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -16.402903/6.231556
[main_keras.py::train] Output mean/std: 0.912779/1.494458

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.098049
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.746052, max: 0.096005
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.09600520879030228
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.4066618415096173e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 34
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.26307255029678345
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.022648, max: 0.098049
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.002838, max: 0.096005
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.103997
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.513992
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.819689
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.268089
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.263073
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.513992
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.819689
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.268089
[utils/util.py::ComputeLoss.__call__] Total loss: 4.601770
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 4.601770
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [main_keras.py::train] KERAS BATCH 2 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.000/1.000
[main_keras.py::train] Targets shape: (6, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 6
[main_keras.py::train] Target sample: [[2.         0.         0.91003066 0.21116325 0.06300424 0.11818977]
 [2.         0.         0.3569252  0.17479718 0.05050337 0.10000674]
 [2.         0.         0.95194256 0.765746   0.04952606 0.10909826]
 [2.         0.         0.02378941 0.7930206  0.04757094 0.10000676]
 [3.         0.         0.93328387 0.4224008  0.12709987 0.25320905]]
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -16.521587/5.863144
[main_keras.py::train] Output mean/std: 0.903108/1.509737

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.089803
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.691664, max: 0.088208
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.08820807188749313
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.211237637439467e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.4506112337112427
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.016480, max: 0.089803
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003933, max: 0.088208
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.996558
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.331378
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.112245
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.941135
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.450611
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.331378
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.112245
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.941135
[utils/util.py::ComputeLoss.__call__] Total loss: 7.384758
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 7.384758
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.129417
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.687706, max: 0.125596
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.1255960464477539
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.666359660314811e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8859217166900635
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.039798, max: 0.129328
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.024723, max: 0.125596
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.021910
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.177998
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.880359
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.651391
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.885922
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.177998
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.880359
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.651391
[utils/util.py::ComputeLoss.__call__] Total loss: 13.709747
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.102386
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.699900, max: 0.085876
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.08587580174207687
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.2038174013184744e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 43.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.5256493091583252
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (43, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (43, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (43, 1), h: (43, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (43, 1), h: (43, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (43, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (43, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (43, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.027412, max: 0.095333
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (43, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (43, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (43, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (43, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.005512, max: 0.085876
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (172, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (172,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (43, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.688594
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.469767
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.632792
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.962220
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.525649
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 43.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.469767
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.632792
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.962220
[utils/util.py::ComputeLoss.__call__] Total loss: 8.064777
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.099555
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.768082, max: 0.092727
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.09272656589746475
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.372350007197383e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.6227601766586304
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.014762, max: 0.099555
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.013562, max: 0.092727
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (148, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (148,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (37, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.621387
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.987170
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.274672
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.349121
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.622760
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.987170
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.274672
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.349121
[utils/util.py::ComputeLoss.__call__] Total loss: 9.610962
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.209283
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.837526, max: 0.190543
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.1905430406332016
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.4514012036670465e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8917105197906494
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.012460, max: 0.186343
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007353, max: 0.179109
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.374456
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.115255
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.839068
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.955124
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.891711
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.115255
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.839068
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.955124
[utils/util.py::ComputeLoss.__call__] Total loss: 12.909447
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.181784
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.920629, max: 0.148057
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.14805668592453003
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.8571837472336483e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.4542752504348755
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.021831, max: 0.181784
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.008233, max: 0.148057
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.121448
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.569187
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.989459
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.294857
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.454275
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.569187
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.989459
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.294857
[utils/util.py::ComputeLoss.__call__] Total loss: 5.853503
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.783234
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.875115, max: 0.779697
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.779696524143219
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.07370268553495407
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.621565818786621
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.139755, max: 0.783234
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.136274, max: 0.779697
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.974541
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.570122
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.591252
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.581957
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.621566
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.570122
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.591252
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.581957
[utils/util.py::ComputeLoss.__call__] Total loss: 8.743331
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.090385
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.849002, max: 0.065732
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.06573231518268585
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.107686469798864e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 16
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.09109002351760864
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.017659, max: 0.071100
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.007134, max: 0.061342
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (56, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (56,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (14, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.395429
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.161179
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.644675
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.282624
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.091090
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.161179
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.644675
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.282624
[utils/util.py::ComputeLoss.__call__] Total loss: 2.088478
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.364227
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.857065, max: 0.344758
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.34475815296173096
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.3558731552620884e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.544400691986084
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.033315, max: 0.364227
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.001442, max: 0.344758
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.025375
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.625706
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.433452
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.853362
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.544401
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.625706
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.433452
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.853362
[utils/util.py::ComputeLoss.__call__] Total loss: 12.912520
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.386937
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.905812, max: 0.383819
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.38381853699684143
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.927749200258404e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 58
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.9075374603271484
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (44, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (44, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (44, 1), h: (44, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (44, 1), h: (44, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (44, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (44, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.023254, max: 0.386937
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (44, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (44, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.008232, max: 0.383819
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (176, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (176,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (44, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.036554
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.086921
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.827399
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.586357
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.907537
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.086921
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.827399
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.586357
[utils/util.py::ComputeLoss.__call__] Total loss: 12.500677
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.714636
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.953445, max: 0.705745
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7057446241378784
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004617048427462578
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.886787176132202
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.041023, max: 0.714636
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.040697, max: 0.705745
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.164845
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.693059
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.571845
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.072298
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.886787
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.693059
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.571845
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.072298
[utils/util.py::ComputeLoss.__call__] Total loss: 9.337202
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.694065
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.770136, max: 0.687521
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.68752121925354
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.037766724824905396
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 63
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.926379442214966
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.075545, max: 0.694065
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.072731, max: 0.687521
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (152, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (152,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (38, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.565862
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.341441
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.403410
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.206930
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.926379
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.341441
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.403410
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.206930
[utils/util.py::ComputeLoss.__call__] Total loss: 9.951780
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.590022
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.947596, max: 0.575262
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5752624273300171
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.876918193185702e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 15
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 13.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.341747760772705
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (13, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (13, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (13, 1), h: (13, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (13, 1), h: (13, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (13, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (13, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.032764, max: 0.590022
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (13, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (13, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.030651, max: 0.575262
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (52, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (52,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (13, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.962598
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.713787
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.774899
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.923219
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.341748
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 13.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.713787
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.774899
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.923219
[utils/util.py::ComputeLoss.__call__] Total loss: 11.411904
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.731998
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.938710, max: 0.730316
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7303155660629272
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.001538468524813652
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 45
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.0887651443481445
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.060060, max: 0.731998
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.041220, max: 0.730316
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.146149
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.916124
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.664991
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.386392
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.088765
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.916124
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.664991
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.386392
[utils/util.py::ComputeLoss.__call__] Total loss: 10.967507
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.740836
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.807711, max: 0.738331
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7383307218551636
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0028546424582600594
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.078915596008301
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.103927, max: 0.740836
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.054361, max: 0.738331
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.960415
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.798528
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.308587
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.045174
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.078916
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.798528
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.308587
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.045174
[utils/util.py::ComputeLoss.__call__] Total loss: 9.152289
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.778446
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.976021, max: 0.774709
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7747090458869934
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.017415376380085945
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 42
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.2241315841674805
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.031444, max: 0.778446
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.001614, max: 0.774709
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (152, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (152,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (38, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.176862
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.097453
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.840288
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.937877
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.224132
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.097453
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.840288
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.937877
[utils/util.py::ComputeLoss.__call__] Total loss: 7.875618
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.742120
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.977964, max: 0.736420
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7364199161529541
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.02748330682516098
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.9422569274902344
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.081611, max: 0.742120
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.010553, max: 0.736420
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.151263
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.700694
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.583073
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.242901
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.942257
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.700694
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.583073
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.242901
[utils/util.py::ComputeLoss.__call__] Total loss: 9.526668
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.694484
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.024884, max: 0.683168
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6831675171852112
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002708778018131852
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 47
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.659043312072754
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.175237, max: 0.694484
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.077582, max: 0.683168
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.030927
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.411205
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.141211
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.046052
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.659043
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.411205
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.141211
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.046052
[utils/util.py::ComputeLoss.__call__] Total loss: 9.598469
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.602282
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.960235, max: 0.582751
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5827509760856628
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0004866175586357713
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.689448595046997
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.088976, max: 0.602282
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.009780, max: 0.582751
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.364647
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.468423
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.684098
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.720603
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.689449
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.468423
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.684098
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.720603
[utils/util.py::ComputeLoss.__call__] Total loss: 11.873125
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.489504
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.028555, max: 0.484492
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.4844922721385956
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.001177310710772872
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.6760149002075195
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.091050, max: 0.489504
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.011446, max: 0.484492
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.031960
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.711543
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.730230
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.291676
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.676015
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.711543
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.730230
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.291676
[utils/util.py::ComputeLoss.__call__] Total loss: 10.733448
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.509440
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.019010, max: 0.486281
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.4862809181213379
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0005357981426641345
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.5859222412109375
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.158103, max: 0.509440
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.064603, max: 0.486281
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.076860
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.560911
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.491860
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.980863
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.585922
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.560911
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.491860
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.980863
[utils/util.py::ComputeLoss.__call__] Total loss: 11.033634
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.788751
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.976630, max: 0.788643
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7886433601379395
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.017744209617376328
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.1754422187805176
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.082026, max: 0.788751
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.006685, max: 0.788643
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.944150
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.484760
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.164205
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.889748
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.175442
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.484760
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.164205
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.889748
[utils/util.py::ComputeLoss.__call__] Total loss: 9.538713
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.680793
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.982931, max: 0.678836
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6788362860679626
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004124404862523079
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.789819717407227
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (44, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (44, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (44, 1), h: (44, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (44, 1), h: (44, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (44, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (44, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.119296, max: 0.680793
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (44, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (44, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.005908, max: 0.678836
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (176, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (176,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (44, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.968176
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.647281
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.552118
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.834950
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.789820
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.647281
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.552118
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.834950
[utils/util.py::ComputeLoss.__call__] Total loss: 9.034348
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.828674
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.960913, max: 0.828362
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8283621072769165
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.03847435489296913
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 39
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.577122211456299
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.077697, max: 0.828674
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.074565, max: 0.828362
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (148, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (148,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (37, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.649217
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.266892
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.198894
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.545340
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.577122
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.266892
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.198894
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.545340
[utils/util.py::ComputeLoss.__call__] Total loss: 8.011127
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.611962
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.940132, max: 0.600154
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6001539826393127
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005669493693858385
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 14
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.7404687404632568
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.177880, max: 0.611962
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.080411, max: 0.600154
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (56, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (56,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (14, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.036406
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.297511
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.459002
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.893423
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.740469
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.297511
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.459002
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.893423
[utils/util.py::ComputeLoss.__call__] Total loss: 10.649937
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.679025
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.984213, max: 0.674883
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6748828291893005
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004416196141391993
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.272900581359863
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.160939, max: 0.679025
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051533, max: 0.674883
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (132, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (132,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (33, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.794456
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.875957
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.115829
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.035020
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.272901
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.875957
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.115829
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.035020
[utils/util.py::ComputeLoss.__call__] Total loss: 10.026807
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.816128
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.987604, max: 0.815836
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8158355355262756
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0033568060025572777
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 44
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.8905487060546875
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.151989, max: 0.816128
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.042873, max: 0.815836
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (152, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (152,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (38, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.015034
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.137381
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.515368
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.932095
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.890549
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.137381
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.515368
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.932095
[utils/util.py::ComputeLoss.__call__] Total loss: 9.584844
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.678426
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.990293, max: 0.675645
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6756454110145569
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0037280498072504997
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.68369197845459
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.152305, max: 0.678426
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.045353, max: 0.675645
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.046720
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.355393
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.663528
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.881342
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.683692
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.355393
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.663528
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.881342
[utils/util.py::ComputeLoss.__call__] Total loss: 8.900264
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.726739
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.989038, max: 0.721569
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7215685248374939
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.020390817895531654
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.539453506469727
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.072102, max: 0.726739
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.020486, max: 0.721569
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.330148
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.528051
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.188862
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.407640
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.539454
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.528051
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.188862
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.407640
[utils/util.py::ComputeLoss.__call__] Total loss: 7.124553
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.705578
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.054578, max: 0.698021
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6980213522911072
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.060417935252189636
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.5160129070281982
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.204672, max: 0.705578
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.118375, max: 0.698021
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.252877
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.507756
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.862196
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.024625
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.516013
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.507756
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.862196
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.024625
[utils/util.py::ComputeLoss.__call__] Total loss: 10.394577
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.633762
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.007002, max: 0.622193
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.622192919254303
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00011474709754111245
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 29
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.762879371643066
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.058619, max: 0.633762
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.046864, max: 0.622193
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.605768
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.975471
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.074069
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.897282
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.762879
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.975471
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.074069
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.897282
[utils/util.py::ComputeLoss.__call__] Total loss: 11.946824
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.751421
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.011405, max: 0.748528
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7485283613204956
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0005153241800144315
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 44
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.2248778343200684
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.103688, max: 0.751421
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.006175, max: 0.748528
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.790721
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.188240
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.332069
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.629078
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.224878
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.188240
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.332069
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.629078
[utils/util.py::ComputeLoss.__call__] Total loss: 11.149386
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.760449
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.006861, max: 0.758658
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7586581110954285
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0003235249896533787
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 29
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.4816272258758545
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.029919, max: 0.760449
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.027849, max: 0.758658
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.710122
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.846480
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.296115
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.983730
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.481627
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.846480
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.296115
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.983730
[utils/util.py::ComputeLoss.__call__] Total loss: 12.126326
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.895093
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.967464, max: 0.894266
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8942661881446838
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002576396567746997
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 55
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.934060096740723
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.188429, max: 0.895093
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.099945, max: 0.894266
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (148, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (148,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (37, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.888782
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.433017
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.174150
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.996986
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.934060
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.433017
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.174150
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.996986
[utils/util.py::ComputeLoss.__call__] Total loss: 11.604152
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.757048
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.012459, max: 0.750460
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7504600882530212
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0014095406513661146
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 61
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.611135482788086
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.116333, max: 0.757048
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.110619, max: 0.750460
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.805475
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.815458
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.862883
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.211969
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.611135
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.815458
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.862883
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.211969
[utils/util.py::ComputeLoss.__call__] Total loss: 9.890310
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.759309
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.013311, max: 0.754414
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7544144988059998
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0010948872659355402
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 53
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 45.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.540534973144531
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (45, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (45, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (45, 1), h: (45, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (45, 1), h: (45, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (45, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (45, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (45, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.085828, max: 0.759309
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (45, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (45, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (45, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (45, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.076530, max: 0.754414
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (180, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (180,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (45, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.663587
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.074619
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.806403
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.769327
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.540535
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 45.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.074619
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.806403
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.769327
[utils/util.py::ComputeLoss.__call__] Total loss: 10.650349
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.878633
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.036829, max: 0.877567
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8775665163993835
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.012854615226387978
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 36
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.9477005004882812
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.081006, max: 0.878633
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.078531, max: 0.877567
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.770877
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.058475
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.999376
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.612436
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.947701
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.058475
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.999376
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.612436
[utils/util.py::ComputeLoss.__call__] Total loss: 8.670286
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.726900
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.049339, max: 0.726879
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7268787026405334
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.01170261763036251
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.6848623752593994
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.140750, max: 0.726900
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.029095, max: 0.726879
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.879003
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.327148
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.757305
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.712167
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.684862
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.327148
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.757305
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.712167
[utils/util.py::ComputeLoss.__call__] Total loss: 7.796619
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.764809
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.044844, max: 0.761047
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7610471844673157
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.014691411517560482
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 58
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.480208396911621
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.126917, max: 0.764809
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.045217, max: 0.761047
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.916041
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.094365
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.619185
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.126583
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.480208
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.094365
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.619185
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.126583
[utils/util.py::ComputeLoss.__call__] Total loss: 9.840133
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.750380
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.005132, max: 0.745459
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7454594969749451
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.007106802426278591
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 42
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.266242027282715
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.062164, max: 0.750380
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.041494, max: 0.745459
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (164, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (164,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (41, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.543451
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.718757
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.435855
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.704252
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.266242
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.718757
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.435855
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.704252
[utils/util.py::ComputeLoss.__call__] Total loss: 10.858865
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.667263
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.970711, max: 0.658009
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6580091118812561
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0005515835946425796
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.8311214447021484
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.118863, max: 0.667263
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.009695, max: 0.658009
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.667408
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.534734
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.209108
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.021715
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.831121
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.534734
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.209108
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.021715
[utils/util.py::ComputeLoss.__call__] Total loss: 11.765558
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---

[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (4, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (4, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: 0.000, Recall: 0.000, mAP50: 0.000, mAP: 0.000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1

=== DEBUG: visualize_predictions input shapes (vis_count=0) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.322/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[ 0.        0.       18.       17.31     24.       23.380001]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=1) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.341/0.761
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       245.35      19.5       21.289993  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=2) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.396/0.792
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       127.97      43.38      26.070007  27.54    ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=3) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.227/0.800
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       243.62      25.5       22.440002  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=4) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.027/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       235.        44.67      20.669998  21.330002]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (1, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (1, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: 0.000, Recall: 0.000, mAP50: 0.000, mAP: 0.000

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.48236448 0.49525484 0.08391395 0.17478162]]

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (0, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.41712236 0.68044674 0.08194223 0.17000681]
 [0.         0.         0.8453499  0.42778838 0.08780318 0.15761289]]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.3587552  0.8849675  0.09732193 0.1831119 ]]
[main_keras.py::data_generator] Batch samples shape: (4, 128, 256, 3)
[main_keras.py::data_generator] Batch targets shape: (4, 6)
[main_keras.py::data_generator] Batch shapes shape: (4, 3, 2)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.95464313 0.9353776  0.09070581 0.12922919]]

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.719665
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.974530, max: 0.715161
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.715161144733429
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0007021601195447147
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 25
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.482250690460205
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.094127, max: 0.719665
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.088880, max: 0.715161
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.352334
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.883774
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.891343
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.471089
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.482251
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.883774
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.891343
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.471089
[utils/util.py::ComputeLoss.__call__] Total loss: 9.246205
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.733863
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.966128, max: 0.729994
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7299938201904297
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00020320495241321623
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.763399600982666
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.136166, max: 0.733863
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.025012, max: 0.729994
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.651551
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.734798
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.428155
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.591575
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.763400
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.734798
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.428155
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.591575
[utils/util.py::ComputeLoss.__call__] Total loss: 11.754530
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.881626
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.967058, max: 0.881252
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.881251871585846
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0013662928249686956
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 58
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 50.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.887509346008301
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (50, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (50, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (50, 1), h: (50, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (50, 1), h: (50, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (50, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (50, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (50, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.071691, max: 0.881626
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (50, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (50, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (50, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (50, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.064233, max: 0.881252
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (200, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (200,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (50, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.670786
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.168886
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.287732
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.665555
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.887509
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 50.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.168886
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.287732
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.665555
[utils/util.py::ComputeLoss.__call__] Total loss: 11.122173
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.592523
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.965444, max: 0.581595
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5815945267677307
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00027453346410766244
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.9001688957214355
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.113139, max: 0.539484
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.031457, max: 0.519720
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.665254
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.419310
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.420917
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.788183
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.900169
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.419310
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.420917
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.788183
[utils/util.py::ComputeLoss.__call__] Total loss: 12.628410
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.631337
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.987020, max: 0.619811
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6198112368583679
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0008314758306369185
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.5906004905700684
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.055552, max: 0.631337
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.036297, max: 0.619811
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.490736
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.309260
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.178649
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.591379
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.590600
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.309260
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.178649
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.591379
[utils/util.py::ComputeLoss.__call__] Total loss: 10.079288
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.751274
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.008680, max: 0.746324
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7463238835334778
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002959842560812831
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.171853065490723
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.137703, max: 0.751274
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.059611, max: 0.746324
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (164, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (164,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (41, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.677965
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.853402
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.604471
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.913135
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.171853
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.853402
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.604471
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.913135
[utils/util.py::ComputeLoss.__call__] Total loss: 9.371009
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.604580
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.987026, max: 0.587841
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5878410339355469
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.007762080058455467
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.113616943359375
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.072944, max: 0.604580
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.063854, max: 0.587841
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.581218
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.763312
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.775617
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.711292
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.113617
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.763312
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.775617
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.711292
[utils/util.py::ComputeLoss.__call__] Total loss: 8.250221
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.692102
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.032098, max: 0.684872
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6848723292350769
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.007909039966762066
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.533143997192383
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.217355, max: 0.692102
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.137727, max: 0.684872
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.380297
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.421125
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.112523
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.621098
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.533144
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.421125
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.112523
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.621098
[utils/util.py::ComputeLoss.__call__] Total loss: 9.154747
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.701381
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.030819, max: 0.693603
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6936032772064209
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.012941054999828339
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 54
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 45.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.8938140869140625
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (45, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (45, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (45, 1), h: (45, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (45, 1), h: (45, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (45, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (45, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (45, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.129853, max: 0.701381
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (45, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (45, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (45, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (45, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.010387, max: 0.693603
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (180, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (180,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (45, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.893835
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.138125
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.750508
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.270972
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.893814
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 45.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.138125
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.750508
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.270972
[utils/util.py::ComputeLoss.__call__] Total loss: 9.159606
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.695623
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.010355, max: 0.684330
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6843296885490417
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.007444419432431459
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.417238712310791
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.159303, max: 0.695623
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.055644, max: 0.684330
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.679596
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.658723
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.158507
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.662086
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.417239
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.658723
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.158507
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.662086
[utils/util.py::ComputeLoss.__call__] Total loss: 8.479317
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.721934
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.982628, max: 0.713453
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7134528756141663
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.023542437702417374
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.436063766479492
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.157281, max: 0.721934
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051826, max: 0.713453
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.600578
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.500994
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.104713
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.309894
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.436064
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.500994
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.104713
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.309894
[utils/util.py::ComputeLoss.__call__] Total loss: 6.915601
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.629454
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.025662, max: 0.622048
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6220479607582092
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.001790903857909143
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 15
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 15.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.043855667114258
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (15, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (15, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (15, 1), h: (15, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (15, 1), h: (15, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (15, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (15, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.137764, max: 0.629454
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (15, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (15, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.022790, max: 0.622048
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (60, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (60,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (15, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.706240
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.451228
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.707116
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.658312
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.043856
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 15.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.451228
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.707116
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.658312
[utils/util.py::ComputeLoss.__call__] Total loss: 10.816656
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.660212
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.037809, max: 0.656496
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6564956903457642
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.001866344828158617
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.623983860015869
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.124753, max: 0.660212
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.002996, max: 0.656496
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (148, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (148,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (37, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.740599
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.939747
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.711191
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.640593
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.623984
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.939747
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.711191
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.640593
[utils/util.py::ComputeLoss.__call__] Total loss: 9.291531
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.561189
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.051885, max: 0.543941
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5439410209655762
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0009263865649700165
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 41
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.44267463684082
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.232362, max: 0.561189
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.156423, max: 0.543941
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.891372
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.299431
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.371343
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.414604
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.442675
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.299431
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.371343
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.414604
[utils/util.py::ComputeLoss.__call__] Total loss: 11.085379
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.722735
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.821287, max: 0.715739
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7157388925552368
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.006864218506962061
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.041199684143066
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.147402, max: 0.722735
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.034575, max: 0.715739
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.032918
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.135879
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.644581
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.319397
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.041200
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.135879
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.644581
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.319397
[utils/util.py::ComputeLoss.__call__] Total loss: 10.099857
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.699138
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.066034, max: 0.690591
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.690591037273407
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.008616241626441479
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 17
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.8194658756256104
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.105371, max: 0.699138
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.042646, max: 0.690591
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (68, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (68,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (17, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.167071
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.038939
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.297652
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.288539
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.819466
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.038939
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.297652
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.288539
[utils/util.py::ComputeLoss.__call__] Total loss: 9.625130
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (10, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.775468
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.140078, max: 0.770178
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7701777815818787
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005016971379518509
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 78
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 65.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 8.052780151367188
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (65, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (65, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (65, 1), h: (65, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (65, 1), h: (65, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (65, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (65, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (65, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.149278, max: 0.775468
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (65, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (65, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (65, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (65, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.047331, max: 0.770178
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (260, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (260,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (65, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.624092
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.367990
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.225704
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.558135
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 8.052780
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 65.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.367990
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.225704
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.558135
[utils/util.py::ComputeLoss.__call__] Total loss: 9.151829
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.561036
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.996832, max: 0.543512
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5435119271278381
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0010828382801264524
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.2652063369750977
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.142608, max: 0.561036
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.032273, max: 0.543512
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.109484
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.798931
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.458558
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.972425
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.265206
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.798931
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.458558
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.972425
[utils/util.py::ComputeLoss.__call__] Total loss: 11.229914
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.622702
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.110289, max: 0.620854
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6208541989326477
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0018107184441760182
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.513097286224365
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.152414, max: 0.622702
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.016498, max: 0.620854
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.307021
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.651391
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.811055
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.642786
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.513097
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.651391
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.811055
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.642786
[utils/util.py::ComputeLoss.__call__] Total loss: 10.105232
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.654952
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.131939, max: 0.652926
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6529256105422974
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.007783229928463697
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 39
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.031463623046875
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.136882, max: 0.654952
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.023613, max: 0.652926
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.579695
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.560542
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.892601
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.631745
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.031464
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.560542
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.892601
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.631745
[utils/util.py::ComputeLoss.__call__] Total loss: 9.084888
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.588471
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.148701, max: 0.586282
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5862818360328674
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0027731123846024275
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 22
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.9419033527374268
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.175904, max: 0.588471
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.075266, max: 0.586282
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.676326
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.451686
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.482291
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.453961
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.941903
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.451686
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.482291
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.453961
[utils/util.py::ComputeLoss.__call__] Total loss: 10.387938
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.864177
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.134879, max: 0.862497
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8624967932701111
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.03790201619267464
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.9384782314300537
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.242844, max: 0.864177
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.157049, max: 0.862497
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.720948
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.023024
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.408671
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.617827
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.938478
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.023024
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.408671
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.617827
[utils/util.py::ComputeLoss.__call__] Total loss: 8.049522
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.770522
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.131769, max: 0.766538
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7665383815765381
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005651354789733887
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 57
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 51.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.557611465454102
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (51, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (51, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (51, 1), h: (51, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (51, 1), h: (51, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (51, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (51, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (51, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.160958, max: 0.770522
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (51, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (51, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (51, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (51, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.058646, max: 0.766538
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (204, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (204,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (51, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.664089
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.969575
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.363163
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.674535
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.557611
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 51.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.969575
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.363163
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.674535
[utils/util.py::ComputeLoss.__call__] Total loss: 9.007273
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.719756
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.094235, max: 0.716109
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7161091566085815
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0039836042560637
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 25
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.671088695526123
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.113200, max: 0.719756
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.054388, max: 0.716109
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.488877
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.963171
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.756986
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.482756
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.671089
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.963171
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.756986
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.482756
[utils/util.py::ComputeLoss.__call__] Total loss: 10.202913
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.622704
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.143381, max: 0.608914
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6089140176773071
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0017894968623295426
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.3303165435791016
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.109734, max: 0.622704
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.015120, max: 0.608914
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.827525
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.997886
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.511875
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.790228
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.330317
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.997886
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.511875
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.790228
[utils/util.py::ComputeLoss.__call__] Total loss: 10.299989
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.770765
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.980188, max: 0.765513
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7655131220817566
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.02192901261150837
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.428342819213867
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.221831, max: 0.770765
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.144709, max: 0.765513
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.332721
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.285782
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.196640
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.341658
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.428343
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.285782
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.196640
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.341658
[utils/util.py::ComputeLoss.__call__] Total loss: 7.824080
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (1, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.532328
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.052631, max: 0.519557
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5195565223693848
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0013329469365999103
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 16
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.0482374429702759
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.254627, max: 0.532328
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.205771, max: 0.519557
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (40, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (40,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (10, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.522755
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.758520
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.018944
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.940594
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.048237
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.758520
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.018944
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.940594
[utils/util.py::ComputeLoss.__call__] Total loss: 11.718058
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.749057
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.220619, max: 0.743031
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.74303138256073
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0037761025596410036
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 45
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.584672451019287
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.160134, max: 0.749057
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.055385, max: 0.743031
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.662833
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.340770
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.316183
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.957713
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.584672
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.340770
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.316183
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.957713
[utils/util.py::ComputeLoss.__call__] Total loss: 9.614666
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.482601
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.217730, max: 0.464246
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.4642462730407715
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0001599106763023883
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 19
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.047617435455322
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.099330, max: 0.482601
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.029008, max: 0.464246
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.302127
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.796682
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.860416
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.731734
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.047617
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.796682
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.860416
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.731734
[utils/util.py::ComputeLoss.__call__] Total loss: 11.388833
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.605140
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.229011, max: 0.589159
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5891586542129517
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0003931144019588828
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.234957456588745
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.123699, max: 0.605140
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003985, max: 0.589159
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (68, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (68,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (17, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.688251
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.618981
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.915988
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.128523
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.234957
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.618981
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.915988
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.128523
[utils/util.py::ComputeLoss.__call__] Total loss: 10.663492
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (10, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.599395
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.048061, max: 0.591309
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5913091897964478
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002837424399331212
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 34
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.639035701751709
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.118055, max: 0.599395
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.088727, max: 0.591309
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.172568
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.799158
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.069819
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.529306
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.639036
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.799158
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.069819
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.529306
[utils/util.py::ComputeLoss.__call__] Total loss: 9.398283
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.551859
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.206289, max: 0.531439
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5314390063285828
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0006973738200031221
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 17
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.8053064346313477
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.056586, max: 0.551859
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051114, max: 0.531439
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (68, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (68,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (17, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.105517
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.800589
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.335322
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.310583
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.805306
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.800589
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.335322
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.310583
[utils/util.py::ComputeLoss.__call__] Total loss: 9.446495
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.674616
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.223256, max: 0.664107
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6641072034835815
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.013113345019519329
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 18
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.529714584350586
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.177537, max: 0.674616
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.129785, max: 0.664107
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.083511
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.414953
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.615847
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.357280
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.529715
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.414953
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.615847
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.357280
[utils/util.py::ComputeLoss.__call__] Total loss: 8.388081
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.601916
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.187127, max: 0.585546
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5855462551116943
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005205387715250254
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 44
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.065309524536133
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.165358, max: 0.601916
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.070927, max: 0.585546
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.747221
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.430889
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.562893
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.232627
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.065310
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.430889
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.562893
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.232627
[utils/util.py::ComputeLoss.__call__] Total loss: 10.226409
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (11, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.869995
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.170427, max: 0.869616
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8696159720420837
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.08249609917402267
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 59
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 56.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 9.34231185913086
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (56, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (56, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (56, 1), h: (56, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (56, 1), h: (56, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (56, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (56, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (56, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.093420, max: 0.869995
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (56, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (56, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (56, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (56, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007743, max: 0.869616
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (224, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (224,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (56, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.342897
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.629606
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.912811
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.373731
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 9.342312
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 56.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.629606
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.912811
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.373731
[utils/util.py::ComputeLoss.__call__] Total loss: 6.916148
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.734445
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.055584, max: 0.728345
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7283452153205872
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0566345639526844
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.493381023406982
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.126328, max: 0.734445
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.033914, max: 0.728345
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.721671
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.520858
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.501348
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.745483
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.493381
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.520858
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.501348
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.745483
[utils/util.py::ComputeLoss.__call__] Total loss: 7.767689
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.841786
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.969549, max: 0.840961
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8409612774848938
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.034173667430877686
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 47
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.341832160949707
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.222646, max: 0.841786
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.141731, max: 0.840961
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.717911
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.128190
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.654353
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.053066
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.341832
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.128190
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.654353
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.053066
[utils/util.py::ComputeLoss.__call__] Total loss: 7.835608
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.742766
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.012092, max: 0.739550
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7395497560501099
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.021404840052127838
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 47
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.620614528656006
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.164027, max: 0.742766
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.149715, max: 0.739550
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (164, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (164,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (41, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.616639
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.824068
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.295156
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.833847
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.620615
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.824068
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.295156
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.833847
[utils/util.py::ComputeLoss.__call__] Total loss: 7.953071
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.701203
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.827168, max: 0.695266
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.695265531539917
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.010448603890836239
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 49
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.250309944152832
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.198430, max: 0.701203
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.109726, max: 0.695266
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.962719
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.371156
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.206889
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.403896
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.250310
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.371156
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.206889
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.403896
[utils/util.py::ComputeLoss.__call__] Total loss: 8.981941
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.666119
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.049953, max: 0.660716
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.66071617603302
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.008149816654622555
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.242501258850098
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.093989, max: 0.666119
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.064677, max: 0.660716
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.513520
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.263669
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.190880
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.942808
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.242501
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.263669
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.190880
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.942808
[utils/util.py::ComputeLoss.__call__] Total loss: 9.397358
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.628135
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.060893, max: 0.616375
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6163754463195801
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.010925122536718845
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.0117504596710205
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.119545, max: 0.628135
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.027662, max: 0.616375
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.703503
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.845448
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.838404
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.092581
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.011750
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.845448
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.838404
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.092581
[utils/util.py::ComputeLoss.__call__] Total loss: 8.776434
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.760155
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.830356, max: 0.758518
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7585179805755615
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.06275318562984467
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 36
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.167428970336914
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.173756, max: 0.760155
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.092515, max: 0.758518
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.763041
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.038618
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.891584
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.902256
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.167429
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.038618
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.891584
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.902256
[utils/util.py::ComputeLoss.__call__] Total loss: 6.832458
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.598677
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.047990, max: 0.598400
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5983996391296387
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004533507861196995
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 18
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.0081591606140137
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.187828, max: 0.598677
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.152207, max: 0.598400
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.507805
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.230983
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.687388
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.772359
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.008159
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.230983
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.687388
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.772359
[utils/util.py::ComputeLoss.__call__] Total loss: 8.690730
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---

[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (4, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (4, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: 0.000, Recall: 0.000, mAP50: 0.000, mAP: 0.000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1

=== DEBUG: visualize_predictions input shapes (vis_count=0) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.322/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[ 0.        0.       18.       17.31     24.       23.380001]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=1) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.341/0.761
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       245.35      19.5       21.289993  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=2) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.396/0.792
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       127.97      43.38      26.070007  27.54    ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=3) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.227/0.800
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       243.62      25.5       22.440002  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=4) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.027/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       235.        44.67      20.669998  21.330002]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (1, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (1, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: 0.000, Recall: 0.000, mAP50: 0.000, mAP: 0.000
