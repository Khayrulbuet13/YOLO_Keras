[main_keras.py::train] Number of classes: 1
[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000
[main_keras.py::train] Model created with input size: (128, 256)

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (4, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (4, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.6594371  0.29099286 0.05009016 0.09549251]
 [0.         0.         0.5590181  0.28739017 0.05091485 0.09701172]
 [0.         0.         0.64420176 0.85491955 0.04566282 0.096187  ]]

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.9660486  0.10815957 0.06790275 0.21631914]]
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.9581837  0.40877384 0.08363262 0.18880463]
 [0.         0.         0.09201896 0.34080422 0.08315277 0.16307998]]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.7879046  0.60021275 0.05679578 0.11527264]]
[main_keras.py::data_generator] Batch samples shape: (4, 128, 256, 3)
[main_keras.py::data_generator] Batch targets shape: (8, 6)
[main_keras.py::data_generator] Batch shapes shape: (4, 3, 2)

--- [main_keras.py::train] KERAS BATCH 0 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.000/0.867
[main_keras.py::train] Targets shape: (8, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 8
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.32928312 0.08895754 0.06995469 0.14482073]
 [0.         0.         0.0601685  0.9238422  0.08582205 0.15229994]]
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -11.926916/7.032541
[main_keras.py::train] Output mean/std: 0.895011/1.275147

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.045488
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.794878, max: 0.038834
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.03883394971489906
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.1469759010380756e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.004095446318387985
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.010405, max: 0.040197
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.001592, max: 0.034816
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.243202
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.717238
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.029793
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.020760
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.004095
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.717238
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.029793
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.020760
[utils/util.py::ComputeLoss.__call__] Total loss: 0.767790
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 0.767790
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [main_keras.py::train] KERAS BATCH 1 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.282/1.000
[main_keras.py::train] Targets shape: (4, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 4
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -21.110264/7.418635
[main_keras.py::train] Output mean/std: 0.872775/1.424216

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.038320
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.718146, max: 0.032687
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.03268714249134064
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.2606785327349286e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.002645036904141307
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.013780, max: 0.034216
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000403, max: 0.032687
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.999476
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.281243
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.019236
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.011418
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.002645
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.281243
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.019236
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.011418
[utils/util.py::ComputeLoss.__call__] Total loss: 0.311898
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 0.311898
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [main_keras.py::train] KERAS BATCH 2 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.227/1.000
[main_keras.py::train] Targets shape: (2, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 2
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -21.598810/7.623368
[main_keras.py::train] Output mean/std: 0.856787/1.527993

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (2, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.087299
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.696811, max: 0.073931
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07393065840005875
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.079062921822583e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.3743685185909271
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.057765, max: 0.083364
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.054242, max: 0.073931
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.897741
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.778347
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.629649
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.625792
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.374369
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.778347
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.629649
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.625792
[utils/util.py::ComputeLoss.__call__] Total loss: 6.033788
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 6.033788
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.046281
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.692108, max: 0.042597
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.04259660094976425
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.00920119483483e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 25
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.021273206919431686
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.007704, max: 0.044586
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.006564, max: 0.042597
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.909809
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.163276
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.153160
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.084357
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.021273
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.163276
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.153160
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.084357
[utils/util.py::ComputeLoss.__call__] Total loss: 0.400793
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.054566
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.721492, max: 0.052931
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05293089151382446
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.151901018487834e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.05873953551054001
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.022617, max: 0.054566
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.012597, max: 0.052931
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.881818
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.329236
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.419114
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.232038
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.058740
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.329236
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.419114
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.232038
[utils/util.py::ComputeLoss.__call__] Total loss: 0.980388
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.076855
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.721779, max: 0.070455
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07045513391494751
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.3871241932861267e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 46.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.2420388162136078
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (46, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (46, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (46, 1), h: (46, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (46, 1), h: (46, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (46, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (46, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (46, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.010303, max: 0.072915
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (46, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (46, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (46, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (46, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000523, max: 0.070455
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (184, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (184,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (46, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.792986
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.171729
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.693611
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.003934
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.242039
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 46.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.171729
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.693611
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.003934
[utils/util.py::ComputeLoss.__call__] Total loss: 3.869275
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.058525
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.762110, max: 0.051435
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05143491178750992
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.6546595451088e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.015551300719380379
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.007840, max: 0.052620
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.016995, max: 0.048596
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (84, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (84,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (21, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.810546
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.111535
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.111805
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.060777
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.015551
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.111535
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.111805
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.060777
[utils/util.py::ComputeLoss.__call__] Total loss: 0.284117
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.113003
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.754334, max: 0.103109
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.10310868918895721
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.943708967341536e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 49
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8123646974563599
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.016278, max: 0.104468
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.014061, max: 0.103109
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.734437
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.070775
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.512345
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.285935
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.812365
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.070775
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.512345
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.285935
[utils/util.py::ComputeLoss.__call__] Total loss: 12.869055
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.048921
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.800445, max: 0.047128
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.04712817817926407
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.363490514412092e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 29
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.028984051197767258
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.017733, max: 0.048921
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003548, max: 0.047128
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.616831
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.228849
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.207899
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.108175
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.028984
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.228849
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.207899
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.108175
[utils/util.py::ComputeLoss.__call__] Total loss: 0.544923
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.110036
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.730277, max: 0.077799
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07779879868030548
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.253726118707561e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 61
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 55.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.37393811345100403
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (55, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (55, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (55, 1), h: (55, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (55, 1), h: (55, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (55, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (55, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (55, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.038903, max: 0.080531
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (55, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (55, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (55, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (55, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.023172, max: 0.077799
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (220, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (220,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (55, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.494173
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.961748
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.624314
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.450687
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.373938
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 55.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.961748
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.624314
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.450687
[utils/util.py::ComputeLoss.__call__] Total loss: 6.036749
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.056561
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.716824, max: 0.054514
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05451367050409317
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.16810819297919e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.060850393027067184
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.012732, max: 0.056378
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.002565, max: 0.054514
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.499448
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.446420
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.433893
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.223610
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.060850
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.446420
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.433893
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.223610
[utils/util.py::ComputeLoss.__call__] Total loss: 1.103923
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.078760
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.732245, max: 0.078155
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07815509289503098
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.74994160776032e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.5087984800338745
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.007853, max: 0.078760
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000715, max: 0.078155
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.355936
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.397979
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.548644
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.764948
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.508798
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.397979
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.548644
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.764948
[utils/util.py::ComputeLoss.__call__] Total loss: 7.711571
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.117341
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.741252, max: 0.103043
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.10304348170757294
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.503161861649005e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 62
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 51.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.6904011964797974
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (51, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (51, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (51, 1), h: (51, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (51, 1), h: (51, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (51, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (51, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (51, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.016778, max: 0.104950
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (51, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (51, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (51, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (51, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.000268, max: 0.103043
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (204, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (204,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (51, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.624198
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.300776
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.721545
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.557372
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.690401
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 51.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.300776
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.721545
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.557372
[utils/util.py::ComputeLoss.__call__] Total loss: 10.579693
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.079707
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.769046, max: 0.063115
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.06311476230621338
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.3139188625999054e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 25
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.14863048493862152
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.026052, max: 0.079707
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.018440, max: 0.063115
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.398315
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.763607
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.049666
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.460474
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.148630
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.763607
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.049666
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.460474
[utils/util.py::ComputeLoss.__call__] Total loss: 2.273747
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (10, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 10, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 10, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 10, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 10
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 10)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 10, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 10, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 10, 1, 1), h: (4, 10, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.060591
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.796822, max: 0.056523
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05652284994721413
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.603213534151493e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 45
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 38.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.03341427072882652
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.012376, max: 0.057947
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000751, max: 0.056523
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (152, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (152,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (38, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.651496
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.297155
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.237848
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.116704
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.033414
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.297155
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.237848
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.116704
[utils/util.py::ComputeLoss.__call__] Total loss: 0.651707
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.171282
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.774577, max: 0.122945
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.12294500321149826
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.387566031662573e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 53
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 42.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8109185695648193
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (42, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (42, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (42, 1), h: (42, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (42, 1), h: (42, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (42, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (42, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.004895, max: 0.134373
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (42, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (42, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003883, max: 0.122945
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (168, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (168,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (42, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.438247
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.386812
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.460083
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.010060
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.810919
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 42.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.386812
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.460083
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.010060
[utils/util.py::ComputeLoss.__call__] Total loss: 12.856956
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.170595
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.778816, max: 0.134591
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.1345914602279663
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.195213669319855e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 21
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 19.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.4266129732131958
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.018781, max: 0.135795
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000560, max: 0.118510
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.176198
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.044514
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.878513
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.429896
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.426613
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.044514
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.878513
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.429896
[utils/util.py::ComputeLoss.__call__] Total loss: 6.352922
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.107836
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.795846, max: 0.103779
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.10377873480319977
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.943488037170482e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8193104863166809
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.021571, max: 0.104743
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.017739, max: 0.101075
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (132, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (132,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (33, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.089185
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.539218
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.634534
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.431754
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.819310
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.539218
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.634534
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.431754
[utils/util.py::ComputeLoss.__call__] Total loss: 11.605505
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.330607
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.860662, max: 0.298021
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.2980208992958069
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.942907126969658e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.7615807056427002
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.076696, max: 0.311532
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.008077, max: 0.287684
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.099530
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.551922
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.869877
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.676959
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.761581
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.551922
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.869877
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.676959
[utils/util.py::ComputeLoss.__call__] Total loss: 13.098757
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (2, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.612144
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.922659, max: 0.604749
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6047491431236267
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0022980128414928913
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 20
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.5724059343338013
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.046444, max: 0.612144
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.039134, max: 0.604749
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (56, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (56,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (14, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.780788
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.675243
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.263411
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.083362
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.572406
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.675243
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.263411
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.083362
[utils/util.py::ComputeLoss.__call__] Total loss: 9.022017
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.376269
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.916602, max: 0.354642
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.354641854763031
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.765128197614104e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.6875287294387817
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.055241, max: 0.354980
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.030186, max: 0.354642
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.772772
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.022983
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.733430
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.317702
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.687529
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.022983
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.733430
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.317702
[utils/util.py::ComputeLoss.__call__] Total loss: 12.074115
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (2, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.189664
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.954728, max: 0.167985
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.16798464953899384
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.8996897210854513e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 13.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.0397382974624634
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (13, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (13, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (13, 1), h: (13, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (13, 1), h: (13, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (13, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (13, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.047479, max: 0.167278
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (13, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (13, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.022848, max: 0.163704
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (52, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (52,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (13, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.212579
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.362043
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 6.344080
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.316532
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.039738
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 13.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.362043
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 6.344080
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.316532
[utils/util.py::ComputeLoss.__call__] Total loss: 15.022655
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.238718
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.944124, max: 0.208130
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.2081303596496582
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.075971908903739e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.018456220626831
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.006177, max: 0.238718
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.005798, max: 0.208130
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (164, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (164,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (41, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.877867
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.403898
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 6.368067
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.396935
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.018456
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.403898
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 6.368067
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.396935
[utils/util.py::ComputeLoss.__call__] Total loss: 13.168900
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.385792
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.969405, max: 0.358921
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.3589208424091339
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.6352674214867875e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.9731853008270264
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.082784, max: 0.385792
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.073376, max: 0.358921
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.949029
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 22.856667
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.972050
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.681046
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.973185
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 22.856667
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.972050
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.681046
[utils/util.py::ComputeLoss.__call__] Total loss: 31.509762
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.752111
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.991871, max: 0.751342
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.751341700553894
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.355957207735628e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.309853553771973
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.173503, max: 0.752111
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.092033, max: 0.751342
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.117770
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.940758
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.023383
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.224933
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.309854
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.940758
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.023383
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.224933
[utils/util.py::ComputeLoss.__call__] Total loss: 14.189073
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.678809
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.971903, max: 0.670079
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6700788736343384
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0004040675994474441
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.7724577188491821
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.029052, max: 0.678809
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.025885, max: 0.670079
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.413758
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.423516
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.182110
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.020718
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.772458
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.423516
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.182110
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.020718
[utils/util.py::ComputeLoss.__call__] Total loss: 11.626343
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.580947
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.984648, max: 0.563344
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5633439421653748
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.359379429137334e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 39
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.6382511854171753
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.040169, max: 0.580947
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.039217, max: 0.563344
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.592695
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.362170
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.016827
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.593805
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.638251
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.362170
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.016827
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.593805
[utils/util.py::ComputeLoss.__call__] Total loss: 12.972801
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (10, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 10, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 10, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 10, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 10
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 10)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 10, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 10, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 10, 1, 1), h: (4, 10, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.701426
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.982173, max: 0.696734
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6967335939407349
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0038920713122934103
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 36
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.229819297790527
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.052741, max: 0.701426
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.020792, max: 0.696734
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (132, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (132,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (33, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.617288
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.093434
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.027085
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.776897
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.229819
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.093434
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.027085
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.776897
[utils/util.py::ComputeLoss.__call__] Total loss: 10.897417
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.611442
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.993114, max: 0.607355
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6073548197746277
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.729336978925858e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.5483617782592773
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.201327, max: 0.547671
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.161250, max: 0.541562
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.520607
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 9.501505
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.148165
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.006810
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.548362
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 9.501505
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.148165
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.006810
[utils/util.py::ComputeLoss.__call__] Total loss: 15.656480
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.650588
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.067113, max: 0.648039
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6480392813682556
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.801328709116206e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 61
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 45.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 44.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.5278327465057373
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (44, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (44, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (44, 1), h: (44, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (44, 1), h: (44, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (44, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (44, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.051418, max: 0.650588
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (44, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (44, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (44, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.047850, max: 0.648039
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (176, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (176,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (44, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.081270
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.316648
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.224887
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.517525
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.527833
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.316648
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.224887
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.517525
[utils/util.py::ComputeLoss.__call__] Total loss: 14.059061
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.712143
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.019487, max: 0.710903
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7109028100967407
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.5042681449558586e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 46.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.209969997406006
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (46, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (46, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (46, 1), h: (46, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (46, 1), h: (46, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (46, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (46, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (46, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.049683, max: 0.712143
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (46, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (46, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (46, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (46, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.046610, max: 0.710903
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (184, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (184,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (46, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.557599
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.450727
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.684313
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.532071
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.209970
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 46.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.450727
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.684313
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.532071
[utils/util.py::ComputeLoss.__call__] Total loss: 12.667110
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.661775
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.008987, max: 0.660558
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.660557746887207
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.1180147439663353e-13
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 0.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.000781
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.000000
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000000
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000000
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 0.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.000781
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.000000
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000000
[utils/util.py::ComputeLoss.__call__] Total loss: 0.000781
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (2, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.690083
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.008244, max: 0.681959
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6819586157798767
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.06009882883518e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 19
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8956936597824097
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.087491, max: 0.690083
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.056539, max: 0.681959
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (40, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (40,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (10, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.670325
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.037742
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.634068
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.912433
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.895694
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.037742
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.634068
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.912433
[utils/util.py::ComputeLoss.__call__] Total loss: 12.584244
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (1, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.307803
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.009244, max: 0.272154
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.27215439081192017
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.509715445990878e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 15
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.31427255272865295
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.163945, max: 0.303396
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.050723, max: 0.267605
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (40, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (40,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (10, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.669112
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.253133
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.823644
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.074843
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.314273
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.253133
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.823644
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.074843
[utils/util.py::ComputeLoss.__call__] Total loss: 5.151620
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (10, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 10, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 10, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 10, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 10
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 10)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 10, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 10, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 10, 1, 1), h: (4, 10, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.680045
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 10, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.008715, max: 0.668135
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6681346297264099
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.9115456679137424e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 53
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 10, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 10, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.409353256225586
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.086592, max: 0.680045
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.040502, max: 0.668135
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.891349
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 8.640747
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.208455
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.269161
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.409353
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 8.640747
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.208455
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.269161
[utils/util.py::ComputeLoss.__call__] Total loss: 15.118362
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.691231
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.010783, max: 0.683254
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6832535266876221
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.8489155283750733e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 45
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.3770365715026855
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.140269, max: 0.691231
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.033839, max: 0.683254
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.034202
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.807056
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.072143
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.115685
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.377037
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.807056
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.072143
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.115685
[utils/util.py::ComputeLoss.__call__] Total loss: 14.994885
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.699678
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.010870, max: 0.691930
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6919299960136414
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0005361991352401674
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.404689788818359
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.104655, max: 0.699678
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.102144, max: 0.691930
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (132, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (132,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (33, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.736797
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.665490
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.033148
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.207762
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.404690
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.665490
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.033148
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.207762
[utils/util.py::ComputeLoss.__call__] Total loss: 11.906401
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.818983
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.022044, max: 0.818083
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8180832862854004
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0022034775465726852
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.9154536724090576
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.179566, max: 0.818983
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.082220, max: 0.818083
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.124582
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.496580
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.601769
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.350082
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.915454
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.496580
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.601769
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.350082
[utils/util.py::ComputeLoss.__call__] Total loss: 10.448431
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.769062
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.029212, max: 0.766859
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7668588161468506
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0019418172305449843
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.6618094444274902
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.075556, max: 0.769062
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.011007, max: 0.766859
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.636478
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.152399
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.671716
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.651677
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.661809
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.152399
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.671716
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.651677
[utils/util.py::ComputeLoss.__call__] Total loss: 11.475792
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.679747
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.004610, max: 0.669896
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.669896125793457
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.006691256072372198
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.397980213165283
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.251670, max: 0.679747
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.172433, max: 0.669896
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.627414
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.032842
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.665530
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.785613
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.397980
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.032842
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.665530
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.785613
[utils/util.py::ComputeLoss.__call__] Total loss: 9.483985
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.672179
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.034518, max: 0.662516
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6625156998634338
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.014103952795267105
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 41
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.316318988800049
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.062515, max: 0.672179
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.022659, max: 0.662516
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.783537
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 22.638603
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.996947
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.821225
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.316319
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 22.638603
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.996947
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.821225
[utils/util.py::ComputeLoss.__call__] Total loss: 28.456778
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.501084
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.965330, max: 0.485474
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.4854743182659149
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.563984591892222e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 20
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 19.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8207272291183472
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (19, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (19, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (19, 1), h: (19, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (19, 1), h: (19, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (19, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (19, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (19, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.073355, max: 0.501084
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (19, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (19, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (19, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (19, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.069939, max: 0.485474
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (76, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (76,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (19, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.838172
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 8.589390
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.411572
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.165839
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.820727
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 19.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 8.589390
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.411572
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.165839
[utils/util.py::ComputeLoss.__call__] Total loss: 14.166800
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.096116
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.988567, max: 0.093738
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.09373801946640015
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.2619849049387852e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 40.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.1269112378358841
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (40, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (40, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (40, 1), h: (40, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (40, 1), h: (40, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (40, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (40, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (40, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.004489, max: 0.096116
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (40, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (40, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (40, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (40, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003712, max: 0.093738
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (160, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (160,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (40, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.212291
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.016195
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.866948
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.425259
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.126911
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 40.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.016195
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.866948
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.425259
[utils/util.py::ComputeLoss.__call__] Total loss: 2.308402
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---

[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (4, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (4, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
Precision: nan, Recall: nan, mAP50: nan, mAP: nan

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508

=== DEBUG: visualize_predictions input shapes (vis_count=0) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.322/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[ 0.        0.       18.       17.31     24.       23.380001]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=1) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.341/0.761
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       245.35      19.5       21.289993  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=2) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.396/0.792
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       127.97      43.38      26.070007  27.54    ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=3) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.227/0.800
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       243.62      25.5       22.440002  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=4) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.027/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       235.        44.67      20.669998  21.330002]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (1, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (1, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
Precision: nan, Recall: nan, mAP50: nan, mAP: nan

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (3, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (3, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.6426786  0.08333562 0.0566569  0.10801149]
 [0.         0.         0.9907681  0.20219734 0.01845598 0.11012262]
 [0.         0.         0.39852348 0.73876905 0.05891538 0.11292112]]

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.85242474 0.14601092 0.07846582 0.16525337]
 [0.         0.         0.73816377 0.9477874  0.08138728 0.10440964]]
[main_keras.py::data_generator] Target shape: (4, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.17557657 0.167741   0.05817313 0.11149853]
 [0.         0.         0.78707325 0.2597515  0.05684006 0.11169244]
 [0.         0.         0.17557657 0.7882545  0.05817313 0.11149853]]
[main_keras.py::data_generator] Batch samples shape: (4, 128, 256, 3)
[main_keras.py::data_generator] Batch targets shape: (9, 6)
[main_keras.py::data_generator] Batch shapes shape: (4, 3, 2)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.606214   0.27414414 0.08380616 0.16908257]]

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.088018
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.949163, max: 0.045949
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.045949071645736694
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.2251079017515663e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0005452496698126197
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.007681, max: 0.046610
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000409, max: 0.045949
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (148, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (148,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (37, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.173666
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.004589
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.003918
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.001780
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000545
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.004589
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.003918
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.001780
[utils/util.py::ComputeLoss.__call__] Total loss: 0.010287
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.604391
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.951697, max: 0.586740
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5867398977279663
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.692672887582575e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 3.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0008170871296897531
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (3, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (3, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (3, 1), h: (3, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (3, 1), h: (3, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (3, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (3, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (3, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.057486, max: 0.170501
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (3, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (3, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (3, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (3, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.055778, max: 0.158425
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (12, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (12,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (3, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.035805
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.007940
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.005765
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.002513
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000817
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 3.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.007940
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.005765
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.002513
[utils/util.py::ComputeLoss.__call__] Total loss: 0.016218
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.582585
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.945173, max: 0.572399
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5723990201950073
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.752311817320722e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0030067958869040012
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.021189, max: 0.448013
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.005685, max: 0.427441
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.121064
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.027365
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.021331
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.009499
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.003007
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.027365
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.021331
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.009499
[utils/util.py::ComputeLoss.__call__] Total loss: 0.058195
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.053039
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.962393, max: 0.049621
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.049620725214481354
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.7675079065290755e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0006110984832048416
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.011571, max: 0.053039
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.000246, max: 0.049621
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.153841
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.005531
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.004378
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.001956
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000611
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.005531
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.004378
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.001956
[utils/util.py::ComputeLoss.__call__] Total loss: 0.011865
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.457125
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.935361, max: 0.447828
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.447828471660614
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.6926565510621003e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 34
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8764012455940247
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.034191, max: 0.457125
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.030793, max: 0.447828
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.813503
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 8.933014
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.306960
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.845479
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.876401
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 8.933014
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.306960
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.845479
[utils/util.py::ComputeLoss.__call__] Total loss: 15.085453
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.643495
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.948261, max: 0.632259
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6322585344314575
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.456121665581293e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 17
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 3.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 7.787307367834728e-06
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (3, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (3, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (3, 1), h: (3, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (3, 1), h: (3, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (3, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (3, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (3, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.034002, max: 0.263760
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (3, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (3, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (3, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (3, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.031733, max: 0.226829
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (12, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (12,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (3, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.798533
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.000077
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.000057
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000021
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000008
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 3.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.000077
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.000057
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000021
[utils/util.py::ComputeLoss.__call__] Total loss: 0.000154
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.441277
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.962481, max: 0.409506
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.409506231546402
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.990577829461218e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.003561142599210143
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.039025, max: 0.278398
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.035155, max: 0.242364
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (84, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (84,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (21, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.805351
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.034711
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.025075
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.010559
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.003561
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.034711
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.025075
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.010559
[utils/util.py::ComputeLoss.__call__] Total loss: 0.070345
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.294194
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.965149, max: 0.275076
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.27507588267326355
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.485098514805941e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.9910001158714294
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.009044, max: 0.294194
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003837, max: 0.275076
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.028325
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 9.128371
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.686065
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.806667
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.991000
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 9.128371
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.686065
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.806667
[utils/util.py::ComputeLoss.__call__] Total loss: 17.621103
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.534998
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.980452, max: 0.520173
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.520172655582428
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.4047854435261797e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.9503393173217773
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.117432, max: 0.532130
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.100296, max: 0.512661
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.023426
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 11.497887
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.957913
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.523177
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.950339
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 11.497887
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.957913
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.523177
[utils/util.py::ComputeLoss.__call__] Total loss: 18.978975
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.572096
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.948915, max: 0.569817
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5698174238204956
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.03621855540581e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 69
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.288204550743103
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.030944, max: 0.288223
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.025841, max: 0.240737
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.014440
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.669274
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.875522
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.891042
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.288205
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.669274
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.875522
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.891042
[utils/util.py::ComputeLoss.__call__] Total loss: 5.435837
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.363830
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.959463, max: 0.329277
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.3292773962020874
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.3297862955805613e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.0428104400634766
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.036732, max: 0.363830
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.035717, max: 0.329277
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.754367
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 8.681993
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.573327
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.666801
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.042810
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 8.681993
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.573327
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.666801
[utils/util.py::ComputeLoss.__call__] Total loss: 16.922121
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.646515
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.959748, max: 0.639273
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6392728686332703
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.5080494853900746e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 36
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.8813114166259766
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.143132, max: 0.646515
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.111069, max: 0.639273
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.655484
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.545495
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.071187
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.175234
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.881311
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.545495
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.071187
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.175234
[utils/util.py::ComputeLoss.__call__] Total loss: 13.791916
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.489663
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.984026, max: 0.465111
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.46511146426200867
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.8455113604431972e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 20
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.534085273742676
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.099493, max: 0.489663
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.082922, max: 0.465111
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.406663
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.161012
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.466197
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.936851
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.534085
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.161012
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.466197
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.936851
[utils/util.py::ComputeLoss.__call__] Total loss: 14.564059
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.600192
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.979829, max: 0.587051
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5870510935783386
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.901377898633655e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 16.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 15.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.8332151174545288
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (15, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (15, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (15, 1), h: (15, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (15, 1), h: (15, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (15, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (15, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.029387, max: 0.399453
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (15, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (15, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.022169, max: 0.386021
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (60, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (60,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (15, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.956510
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.932456
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.082649
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.887200
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.833215
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 15.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.932456
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.082649
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.887200
[utils/util.py::ComputeLoss.__call__] Total loss: 15.902306
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.605209
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.981005, max: 0.600243
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6002433896064758
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0006168689578771591
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.384462356567383
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.170519, max: 0.605209
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.061433, max: 0.600243
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.150390
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.010245
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.320040
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.694806
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.384462
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.010245
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.320040
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.694806
[utils/util.py::ComputeLoss.__call__] Total loss: 12.025091
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.509883
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.969546, max: 0.504180
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5041798949241638
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004607683513313532
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 22
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 13.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.3135762214660645
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (13, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (13, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (13, 1), h: (13, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (13, 1), h: (13, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (13, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (13, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.189657, max: 0.509883
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (13, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (13, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (13, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.097912, max: 0.504180
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (52, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (52,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (13, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.357477
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 22.148254
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.464808
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.746663
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.313576
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 13.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 22.148254
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.464808
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.746663
[utils/util.py::ComputeLoss.__call__] Total loss: 29.359726
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.540545
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.973358, max: 0.521290
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5212904810905457
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.237553086205992e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 41
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 21.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.05218268185853958
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.017721, max: 0.160470
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.013190, max: 0.136951
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (84, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (84,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (21, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.984202
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.553281
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.338681
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.178811
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.052183
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.553281
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.338681
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.178811
[utils/util.py::ComputeLoss.__call__] Total loss: 1.070773
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.127918
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.962269, max: 0.115695
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.11569451540708542
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.4734541631831206e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.026924263685941696
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.015366, max: 0.124918
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007941, max: 0.115695
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (132, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (132,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (33, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.931038
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.299985
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.179504
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.080104
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.026924
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.299985
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.179504
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.080104
[utils/util.py::ComputeLoss.__call__] Total loss: 0.559594
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.396998
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.956820, max: 0.380326
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.38032612204551697
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.55611566440251e-13
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 29
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 17.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.00036227048258297145
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.025757, max: 0.069510
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.023063, max: 0.068233
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (68, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (68,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (17, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.976726
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.004191
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.002543
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.001069
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000362
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.004191
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.002543
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.001069
[utils/util.py::ComputeLoss.__call__] Total loss: 0.007802
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (1, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.194154
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.990496, max: 0.172778
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.17277783155441284
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.7614060210391358e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 16
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.19839218258857727
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.171784, max: 0.179332
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.157737, max: 0.172778
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (40, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (40,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (10, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.074816
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.365900
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.241410
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.613406
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.198392
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.365900
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.241410
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.613406
[utils/util.py::ComputeLoss.__call__] Total loss: 4.220716
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.126151
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.995796, max: 0.119889
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.11988876760005951
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.4709494039477633e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 42.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0246230848133564
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (42, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (42, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (42, 1), h: (42, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (42, 1), h: (42, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (42, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (42, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.052285, max: 0.120857
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (42, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (42, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.048912, max: 0.119889
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (168, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (168,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (42, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.909690
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.300773
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.164340
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.071158
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.024623
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 42.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.300773
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.164340
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.071158
[utils/util.py::ComputeLoss.__call__] Total loss: 0.536271
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.077966
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.956045, max: 0.075992
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07599247246980667
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.609661598767525e-13
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.000239994638832286
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.027864, max: 0.077781
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.019653, max: 0.075992
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.905035
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.003007
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.001675
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000679
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000240
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.003007
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.001675
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000679
[utils/util.py::ComputeLoss.__call__] Total loss: 0.005361
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.148535
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.956125, max: 0.147678
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.14767803251743317
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.431413486687518e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.03625326603651047
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.009468, max: 0.148431
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.001532, max: 0.147678
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.954695
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.457486
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.233628
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.107435
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.036253
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.457486
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.233628
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.107435
[utils/util.py::ComputeLoss.__call__] Total loss: 0.798550
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.731474
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.866766, max: 0.728232
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7282320857048035
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.7333879557407395e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 0.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.000000
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.000000
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000000
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000000
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 0.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.000000
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.000000
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000000
[utils/util.py::ComputeLoss.__call__] Total loss: 0.000000
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.884755
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.956126, max: 0.884463
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.884463369846344
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.904223888628877e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 56
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.08644993603229523
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.029377, max: 0.482988
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.021244, max: 0.474650
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.095350
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.132289
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.506893
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.247809
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.086450
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.132289
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.506893
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.247809
[utils/util.py::ComputeLoss.__call__] Total loss: 1.886991
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.744436
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.988192, max: 0.740296
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7402958869934082
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.741672971087188e-13
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 16.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.50656446244102e-05
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (16, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (16, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (16, 1), h: (16, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (16, 1), h: (16, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (16, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (16, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (16, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.037960, max: 0.149554
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (16, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (16, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (16, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (16, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.034181, max: 0.120456
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (64, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (64,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (16, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.860749
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.000460
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.000248
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000100
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000035
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 16.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.000460
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.000248
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000100
[utils/util.py::ComputeLoss.__call__] Total loss: 0.000808
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.109274
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.958093, max: 0.107748
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.10774781554937363
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.304306047530181e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.003357907524332404
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.022901, max: 0.109274
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.005436, max: 0.107748
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.917493
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.043869
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.022702
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.009477
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.003358
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.043869
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.022702
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.009477
[utils/util.py::ComputeLoss.__call__] Total loss: 0.076049
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.206463
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.946825, max: 0.117974
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.11797439306974411
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.16307515004938e-13
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0003532867121975869
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.050074, max: 0.083394
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.035448, max: 0.082374
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.854500
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.004641
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.002457
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000953
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000353
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.004641
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.002457
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000953
[utils/util.py::ComputeLoss.__call__] Total loss: 0.008051
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.126756
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.958405, max: 0.124359
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.1243593767285347
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.007911612122442e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 29
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.007588808890432119
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.020381, max: 0.125832
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.017084, max: 0.124359
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.927352
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.099986
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.050454
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.021562
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.007589
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.099986
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.050454
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.021562
[utils/util.py::ComputeLoss.__call__] Total loss: 0.172003
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.088744
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.956102, max: 0.075880
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07587961107492447
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.609408136274415e-13
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 14
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.799919068114832e-05
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.022507, max: 0.084661
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.016267, max: 0.075880
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (56, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (56,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (14, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.876862
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.000501
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.000266
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000103
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000038
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.000501
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.000266
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000103
[utils/util.py::ComputeLoss.__call__] Total loss: 0.000871
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.153711
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.956107, max: 0.148049
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.14804872870445251
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.8594082870637685e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.01858958974480629
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.043024, max: 0.153592
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.031204, max: 0.148049
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.899961
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.245985
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.120012
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.055184
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.018590
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.245985
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.120012
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.055184
[utils/util.py::ComputeLoss.__call__] Total loss: 0.421181
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.676267
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.960046, max: 0.666787
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6667866706848145
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.4156316119340318e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.9880886077880859
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.025603, max: 0.495537
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.006513, max: 0.485146
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.931361
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 13.513283
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.102446
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.978483
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.988089
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 13.513283
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.102446
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.978483
[utils/util.py::ComputeLoss.__call__] Total loss: 20.594212
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.493268
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.946633, max: 0.469100
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.46910029649734497
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.7570211952033787e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.5760345458984375
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.027766, max: 0.493268
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.004370, max: 0.469100
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.967177
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 7.659622
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.565318
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.529106
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.576035
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 7.659622
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.565318
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.529106
[utils/util.py::ComputeLoss.__call__] Total loss: 11.754046
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.396401
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.969552, max: 0.376909
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.3769086003303528
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.247460662019307e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.32771891355514526
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.028313, max: 0.396401
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.010415, max: 0.376909
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.863539
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.582294
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.616405
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.659880
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.327719
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.582294
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.616405
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.659880
[utils/util.py::ComputeLoss.__call__] Total loss: 6.858578
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.125100
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.984620, max: 0.122696
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.12269645929336548
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.256411187732791e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.004116748925298452
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.028105, max: 0.125074
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.018345, max: 0.122696
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.857955
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.054369
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.027392
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.011652
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.004117
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.054369
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.027392
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.011652
[utils/util.py::ComputeLoss.__call__] Total loss: 0.093414
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.060557
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.947316, max: 0.058259
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05825911834836006
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.56022577440979e-14
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 20
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.961038626381196e-05
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.042368, max: 0.060126
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.029458, max: 0.058259
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.786517
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.000390
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.000210
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000078
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000030
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.000390
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.000210
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000078
[utils/util.py::ComputeLoss.__call__] Total loss: 0.000678
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.294603
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.989265, max: 0.267256
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.26725587248802185
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.388891720694346e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.9559313654899597
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.025568, max: 0.294603
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.015854, max: 0.267256
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.940896
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 12.544426
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.307485
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.131183
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.955931
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 12.544426
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.307485
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.131183
[utils/util.py::ComputeLoss.__call__] Total loss: 20.983095
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.356631
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.988824, max: 0.354304
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.35430413484573364
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.19016110697612e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 41
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.52177095413208
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.060666, max: 0.356631
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051443, max: 0.354304
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.865450
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 13.072570
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.054276
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.081517
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.521771
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 13.072570
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.054276
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.081517
[utils/util.py::ComputeLoss.__call__] Total loss: 21.208363
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.522124
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.000464, max: 0.501638
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5016383528709412
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.882738729364064e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.0239700078964233
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.038805, max: 0.522124
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.033694, max: 0.501638
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.689402
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 11.464397
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.832892
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.968664
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.023970
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 11.464397
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.832892
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.968664
[utils/util.py::ComputeLoss.__call__] Total loss: 17.265953
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.296598
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.006227, max: 0.289660
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.2896602749824524
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.300948403506254e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.8909623622894287
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.117933, max: 0.296598
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.105727, max: 0.289660
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.725049
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 12.343618
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.521809
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.542719
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.890962
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 12.343618
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.521809
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.542719
[utils/util.py::ComputeLoss.__call__] Total loss: 20.408146
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.487433
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.987956, max: 0.482065
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.482065349817276
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 9.073641393797516e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.207734107971191
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.216380, max: 0.487433
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.167906, max: 0.482065
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.682088
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 11.840885
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.721965
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.204884
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.207734
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 11.840885
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.721965
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.204884
[utils/util.py::ComputeLoss.__call__] Total loss: 18.767735
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.695375
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.984173, max: 0.683253
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.68325275182724
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.232086318254005e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.9748597145080566
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.041001, max: 0.695375
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.002357, max: 0.683253
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.863227
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 10.091764
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.566355
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.858687
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.974860
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 10.091764
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.566355
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.858687
[utils/util.py::ComputeLoss.__call__] Total loss: 15.516807
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.687033
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.957722, max: 0.682076
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6820755004882812
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.183343778800918e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.8439197540283203
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.096197, max: 0.687033
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.034555, max: 0.682076
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.733409
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 10.274399
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.611730
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.808810
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.843920
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 10.274399
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.611730
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.808810
[utils/util.py::ComputeLoss.__call__] Total loss: 15.694939
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---

[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (4, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (4, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
Precision: nan, Recall: nan, mAP50: nan, mAP: nan

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508

=== DEBUG: visualize_predictions input shapes (vis_count=0) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.322/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[ 0.        0.       18.       17.31     24.       23.380001]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=1) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.341/0.761
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       245.35      19.5       21.289993  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=2) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.396/0.792
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       127.97      43.38      26.070007  27.54    ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=3) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.227/0.800
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       243.62      25.5       22.440002  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=4) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.027/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       235.        44.67      20.669998  21.330002]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
[main_keras.py::test] Model outputs shape: (1, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (1, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 508
Precision: nan, Recall: nan, mAP50: nan, mAP: nan
