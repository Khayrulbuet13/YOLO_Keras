[main_keras.py::train] Number of classes: 1
[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000
[main_keras.py::train] Model created with input size: (128, 256)

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.34253597 0.5087941  0.07153389 0.15473261]]

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (3, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (3, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.51561075 0.11011992 0.07924667 0.15101898]
 [0.         0.         0.11284445 0.65257573 0.07239022 0.14124924]
 [0.         0.         0.4500181  0.6349196  0.06312075 0.12947845]]
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.12574375 0.20165011 0.08839554 0.17592824]
 [0.         0.         0.26602352 0.9843259  0.09412122 0.03133261]]
[main_keras.py::data_generator] Batch samples shape: (4, 128, 256, 3)
[main_keras.py::data_generator] Batch targets shape: (6, 6)
[main_keras.py::data_generator] Batch shapes shape: (4, 3, 2)

--- [main_keras.py::train] KERAS BATCH 0 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.298/0.914
[main_keras.py::train] Targets shape: (6, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 6
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.7718601  0.37016013 0.04956263 0.10630047]]
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -12.336386/5.748670
[main_keras.py::train] Output mean/std: 0.834948/1.233249

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.048647
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.689926, max: 0.036364
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.03636375069618225
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.646504956992928e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.005411572754383087
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.018102, max: 0.038245
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.001902, max: 0.036201
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.039998
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.905689
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.039309
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.024272
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.005412
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.905689
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.039309
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.024272
[utils/util.py::ComputeLoss.__call__] Total loss: 0.969271
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 0.969271
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [main_keras.py::train] KERAS BATCH 1 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.000/0.973
[main_keras.py::train] Targets shape: (5, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 5
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -14.782688/5.374644
[main_keras.py::train] Output mean/std: 0.809462/1.419470

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.085912
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.756785, max: 0.059150
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.059150006622076035
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.557767744970079e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.206709086894989
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.011374, max: 0.063649
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.002283, max: 0.059150
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.951987
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.031959
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.463313
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.905262
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.206709
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.031959
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.463313
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.905262
[utils/util.py::ComputeLoss.__call__] Total loss: 3.400534
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 3.400534
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [main_keras.py::train] KERAS BATCH 2 DEBUG ---
[main_keras.py::train] Samples shape: (4, 128, 256, 3)
[main_keras.py::train] Samples dtype: <dtype: 'float32'>
[main_keras.py::train] Samples min/max: 0.000/0.992
[main_keras.py::train] Targets shape: (3, 6)
[main_keras.py::train] Targets dtype: <dtype: 'float32'>
[main_keras.py::train] Number of targets: 3
[main_keras.py::train] Shapes: [[[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]

 [[0. 0.]
  [0. 0.]
  [0. 0.]]]
[main_keras.py::train] Shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
[main_keras.py::train] Shapes dtype: <dtype: 'float32'>
[main_keras.py::train] Shapes shape: (4, 3, 2)
[main_keras.py::train] Batch item 0 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 0 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 0 ratio/padding: [0.0, 0.0]
[main_keras.py::train] Batch item 1 shapes: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::train] Batch item 1 original size: [0.0, 0.0]
[main_keras.py::train] Batch item 1 ratio/padding: [0.0, 0.0]

--- [main_keras.py::train] KERAS MODEL OUTPUT DEBUG ---
[main_keras.py::train] Output shape: (4, 16, 32, 65)
[main_keras.py::train] Output min/max: -16.397243/5.671988
[main_keras.py::train] Output mean/std: 0.798560/1.515274

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.058683
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.682644, max: 0.056802
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05680152028799057
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.903811275294487e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.07879318296909332
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.025205, max: 0.058661
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.020251, max: 0.056802
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.056026
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.456099
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.561392
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.361622
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.078793
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.456099
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.561392
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.361622
[utils/util.py::ComputeLoss.__call__] Total loss: 1.379113
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [main_keras.py::train] KERAS LOSS DEBUG ---
[main_keras.py::train] Loss value: 1.379113
[main_keras.py::train] Loss dtype: <dtype: 'float32'>

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.071710
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.679736, max: 0.057115
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.057115066796541214
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.7796460405914445e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 21.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0398426279425621
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.017185, max: 0.060040
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.008992, max: 0.057115
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (84, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (84,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (21, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.852526
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.248190
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.283602
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.155482
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.039843
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.248190
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.283602
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.155482
[utils/util.py::ComputeLoss.__call__] Total loss: 0.687274
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.045640
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.676474, max: 0.040291
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.04029097408056259
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.2036719711228105e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0008287829114124179
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.013855, max: 0.038983
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.005215, max: 0.037794
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.017486
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.042006
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.006004
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.003242
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000829
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.042006
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.006004
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.003242
[utils/util.py::ComputeLoss.__call__] Total loss: 0.051252
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.063976
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.673795, max: 0.059598
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.059598132967948914
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 4.2672670952370595e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.004741074983030558
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.013477, max: 0.063976
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.001963, max: 0.059598
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.164139
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.055859
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.033826
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.021830
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.004741
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.055859
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.033826
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.021830
[utils/util.py::ComputeLoss.__call__] Total loss: 0.111514
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.061488
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.691988, max: 0.058224
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.05822378024458885
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.7286990162144207e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.08636487275362015
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.018583, max: 0.058479
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.014089, max: 0.058224
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.928082
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.440473
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.614672
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.350714
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.086365
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.440473
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.614672
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.350714
[utils/util.py::ComputeLoss.__call__] Total loss: 1.405860
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.090743
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.676622, max: 0.078218
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.0782180055975914
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.393939739306575e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 41
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.1895812749862671
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.014754, max: 0.079778
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007349, max: 0.078218
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.836192
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 1.174703
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 1.316110
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.790906
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.189581
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 1.174703
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 1.316110
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.790906
[utils/util.py::ComputeLoss.__call__] Total loss: 3.281720
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.031937
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.736997, max: 0.028920
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.02891981042921543
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.9533018865564022e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 22
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.00023391764261759818
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.009608, max: 0.029287
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.006383, max: 0.028920
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.834881
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.024827
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.001708
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.000971
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000234
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.024827
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.001708
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.000971
[utils/util.py::ComputeLoss.__call__] Total loss: 0.027505
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.143337
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.693259, max: 0.138040
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.13804049789905548
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.1532168997518966e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 69
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 47.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8910230398178101
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (47, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (47, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (47, 1), h: (47, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (47, 1), h: (47, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (47, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (47, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (47, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.038711, max: 0.141866
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (47, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (47, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (47, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (47, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.028440, max: 0.138040
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (188, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (188,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (47, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.853713
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.045464
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.975758
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.832092
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.891023
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 47.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.045464
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.975758
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.832092
[utils/util.py::ComputeLoss.__call__] Total loss: 14.853314
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.030892
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.770418, max: 0.028881
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.02888103947043419
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.878205916130195e-12
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 21
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.0003790035843849182
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.009433, max: 0.030719
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.002431, max: 0.028881
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (84, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (84,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (21, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.663228
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.041086
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.002766
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.001439
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.000379
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.041086
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.002766
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.001439
[utils/util.py::ComputeLoss.__call__] Total loss: 0.045291
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.128263
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.682533, max: 0.120394
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.1203935369849205
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.1038618342194013e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.5925797820091248
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.012667, max: 0.128263
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.011650, max: 0.120394
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.872514
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.078827
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.961721
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.967099
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.592580
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.078827
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.961721
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.967099
[utils/util.py::ComputeLoss.__call__] Total loss: 11.007647
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.045674
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.847604, max: 0.042803
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.042802855372428894
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.311763016600189e-11
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 22
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.005913213826715946
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.012209, max: 0.045674
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.010045, max: 0.042803
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.561870
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.534101
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.042541
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.021886
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.005913
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.534101
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.042541
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.021886
[utils/util.py::ComputeLoss.__call__] Total loss: 0.598528
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.125860
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.718858, max: 0.109943
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.10994347184896469
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.970770074384177e-09
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 45
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.0073894262313843
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.077558, max: 0.110873
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.064963, max: 0.109943
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.482121
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.376124
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 6.793065
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.645598
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.007389
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.376124
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 6.793065
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.645598
[utils/util.py::ComputeLoss.__call__] Total loss: 16.814787
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.098659
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.789315, max: 0.079747
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.07974651455879211
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.043632290644638e-10
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.06844763457775116
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.018911, max: 0.095312
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.013876, max: 0.079747
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.357167
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 0.477393
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 0.480440
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 0.206614
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.068448
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 0.477393
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 0.480440
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 0.206614
[utils/util.py::ComputeLoss.__call__] Total loss: 1.164448
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.120673
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.861170, max: 0.115397
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.11539707332849503
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.478616778489595e-08
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 42
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.6283838748931885
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.022185, max: 0.119497
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.015916, max: 0.115397
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.337178
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 2.943887
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.227203
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.048093
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.628384
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 2.943887
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.227203
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.048093
[utils/util.py::ComputeLoss.__call__] Total loss: 9.219183
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.191275
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.866606, max: 0.178616
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.17861627042293549
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 5.193547849557945e-07
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 39
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.486777663230896
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.034052, max: 0.190867
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.012819, max: 0.178616
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.154375
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.326275
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 6.399234
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.967942
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.486778
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.326275
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 6.399234
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.967942
[utils/util.py::ComputeLoss.__call__] Total loss: 13.693451
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.317116
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.899970, max: 0.295986
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.2959858477115631
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 1.1452762009867001e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.1850594282150269
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.017323, max: 0.317116
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.013743, max: 0.295986
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.225780
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.113614
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.474283
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.281567
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.185059
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.113614
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.474283
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.281567
[utils/util.py::ComputeLoss.__call__] Total loss: 13.869463
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.705784
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.920710, max: 0.704907
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7049070596694946
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0017946483567357063
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 68
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 48.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.635848045349121
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (48, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (48, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (48, 1), h: (48, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (48, 1), h: (48, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (48, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (48, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (48, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.031728, max: 0.705784
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (48, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (48, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (48, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (48, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.027338, max: 0.704907
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (192, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (192,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (48, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.057187
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.050725
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.556685
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.438624
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.635848
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 48.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.050725
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.556685
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.438624
[utils/util.py::ComputeLoss.__call__] Total loss: 11.046035
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.581878
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.924643, max: 0.577536
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5775360465049744
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.001084009651094675
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.5246381759643555
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.096351, max: 0.581878
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.088956, max: 0.577536
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.703417
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.712236
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.872269
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.137243
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.524638
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.712236
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.872269
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.137243
[utils/util.py::ComputeLoss.__call__] Total loss: 10.721747
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (11, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 11, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 11, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 11, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 11
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 11)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 11, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 11, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 11, 1, 1), h: (4, 11, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.491174
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.962863, max: 0.489870
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.48986995220184326
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 6.78242722642608e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 11, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 11, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 11, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 43.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 42.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.4800214767456055
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (42, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (42, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (42, 1), h: (42, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (42, 1), h: (42, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (42, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (42, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.027920, max: 0.491174
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (42, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (42, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (42, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.011680, max: 0.489870
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (168, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (168,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (42, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.935100
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.628909
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.596191
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.565157
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.480021
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 42.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.628909
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.596191
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.565157
[utils/util.py::ComputeLoss.__call__] Total loss: 13.790257
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.816340
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.981343, max: 0.815181
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8151808381080627
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.008821789175271988
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.492745876312256
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.171538, max: 0.816340
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.072528, max: 0.815181
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.058195
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.674532
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.287069
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.642464
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.492746
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.674532
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.287069
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.642464
[utils/util.py::ComputeLoss.__call__] Total loss: 10.604065
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.503750
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.973805, max: 0.482508
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.48250752687454224
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.170115476474166e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.505582809448242
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.126322, max: 0.503750
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.048926, max: 0.482507
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.459407
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.832377
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.583653
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.792734
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.505583
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.832377
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.583653
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.792734
[utils/util.py::ComputeLoss.__call__] Total loss: 14.208765
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.606961
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.009555, max: 0.603062
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6030620336532593
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0002977413241751492
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 68
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 40.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.461922645568848
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (40, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (40, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (40, 1), h: (40, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (40, 1), h: (40, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (40, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (40, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (40, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.201664, max: 0.606961
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (40, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (40, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (40, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (40, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.107003, max: 0.603062
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (160, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (160,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (40, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.327643
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.082212
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.386474
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.087377
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.461923
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 40.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.082212
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.386474
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.087377
[utils/util.py::ComputeLoss.__call__] Total loss: 12.556063
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (2, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.506024
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.011859, max: 0.497997
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.4979967176914215
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 8.262568735517561e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 8
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 8.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8060611486434937
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (8, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (8, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (8, 1), h: (8, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (8, 1), h: (8, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (8, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (8, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (8, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.112572, max: 0.506024
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (8, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (8, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (8, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (8, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.107908, max: 0.497997
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (32, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (32,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (8, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.515242
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.180292
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.730469
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.381542
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.806061
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 8.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.180292
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.730469
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.381542
[utils/util.py::ComputeLoss.__call__] Total loss: 9.292303
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.478812
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.015069, max: 0.476275
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.47627541422843933
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00035227680928073823
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 48
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 44.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 38.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.924916744232178
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.235626, max: 0.478812
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.142619, max: 0.476275
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (152, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (152,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (38, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.720765
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.611156
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.642069
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.210128
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.924917
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.611156
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.642069
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.210128
[utils/util.py::ComputeLoss.__call__] Total loss: 10.463354
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.680053
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.025493, max: 0.677526
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6775262355804443
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005603536497801542
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 36
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.241117000579834
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.174315, max: 0.680053
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.076914, max: 0.677526
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.874321
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.191817
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.792588
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.957255
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.241117
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.191817
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.792588
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.957255
[utils/util.py::ComputeLoss.__call__] Total loss: 9.941660
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.771057
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.029611, max: 0.770284
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7702836394309998
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.020318493247032166
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.005580425262451
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (33, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (33, 1), h: (33, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.201046, max: 0.771057
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (33, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (33, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.114832, max: 0.770284
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (132, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (132,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (33, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.750378
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.277863
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.384794
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.652584
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.005580
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.277863
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.384794
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.652584
[utils/util.py::ComputeLoss.__call__] Total loss: 9.315241
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.664798
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.013543, max: 0.655677
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.655676543712616
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.003582400968298316
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.562785625457764
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.156875, max: 0.664798
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.050427, max: 0.655676
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.932943
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.585244
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.086560
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.853527
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.562786
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.585244
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.086560
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.853527
[utils/util.py::ComputeLoss.__call__] Total loss: 9.525331
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.527402
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.003020, max: 0.507899
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5078988671302795
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0010461718775331974
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.939580202102661
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.163620, max: 0.527402
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.064188, max: 0.507899
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.657516
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.300637
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.270633
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.701581
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.939580
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.300637
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.270633
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.701581
[utils/util.py::ComputeLoss.__call__] Total loss: 9.272850
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.816509
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.998203, max: 0.814588
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8145876526832581
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 7.954339707794134e-06
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 58
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 48.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.291016101837158
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (48, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (48, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (48, 1), h: (48, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (48, 1), h: (48, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (48, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (48, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (48, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.150567, max: 0.816509
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (48, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (48, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (48, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (48, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.047323, max: 0.814588
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (192, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (192,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (48, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.166278
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 10.991904
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.163695
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.365281
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.291016
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 48.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 10.991904
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.163695
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.365281
[utils/util.py::ComputeLoss.__call__] Total loss: 17.520880
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.751844
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.046656, max: 0.749249
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7492486834526062
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002409630687907338
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 21
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.3653228282928467
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (21, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (21, 1), h: (21, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.156380, max: 0.751844
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (21, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (21, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.033366, max: 0.749249
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (84, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (84,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (21, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.973627
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.400851
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.494229
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.825639
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.365323
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 21.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.400851
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.494229
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.825639
[utils/util.py::ComputeLoss.__call__] Total loss: 9.720720
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.828490
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.018238, max: 0.826819
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8268194794654846
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.006782527081668377
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.826662540435791
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.172125, max: 0.828490
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.073454, max: 0.826819
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.865907
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.089147
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.303040
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.352861
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.826663
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.089147
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.303040
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.352861
[utils/util.py::ComputeLoss.__call__] Total loss: 7.745049
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.806189
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.044060, max: 0.802938
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8029382228851318
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0090864859521389
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.050362586975098
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.163540, max: 0.806189
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.062959, max: 0.802938
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.811674
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.664670
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.239767
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.692629
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.050363
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.664670
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.239767
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.692629
[utils/util.py::ComputeLoss.__call__] Total loss: 8.597066
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.565756
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.015068, max: 0.560104
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.560103714466095
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0019480028422549367
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 49
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.300752639770508
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.188635, max: 0.565756
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.096754, max: 0.560104
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.199051
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.723589
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.151472
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.517799
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.300753
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.723589
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.151472
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.517799
[utils/util.py::ComputeLoss.__call__] Total loss: 10.392860
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.861398
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.969821, max: 0.860075
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8600747585296631
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.011095657013356686
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 16
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 16.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.2057156562805176
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (16, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (16, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (16, 1), h: (16, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (16, 1), h: (16, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (16, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (16, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (16, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.193003, max: 0.861398
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (16, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (16, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (16, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (16, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.098177, max: 0.860075
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (64, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (64,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (16, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.892582
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.458663
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.418769
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.501582
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.205716
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 16.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.458663
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.418769
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.501582
[utils/util.py::ComputeLoss.__call__] Total loss: 8.379014
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.794679
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.953611, max: 0.791666
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7916659712791443
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.012788579799234867
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.7476677894592285
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.132777, max: 0.794679
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.015645, max: 0.791666
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.333138
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.145362
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.665322
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.322525
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.747668
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.145362
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.665322
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.322525
[utils/util.py::ComputeLoss.__call__] Total loss: 8.133209
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.701418
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.952978, max: 0.696239
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6962386965751648
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.01631174050271511
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 41
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.380568504333496
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.159758, max: 0.701418
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.052424, max: 0.696239
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.166888
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.558385
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.572713
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.299378
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.380569
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.558385
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.572713
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.299378
[utils/util.py::ComputeLoss.__call__] Total loss: 10.430475
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.529531
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.955748, max: 0.510804
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5108038783073425
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00011132747749798
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 16
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 16.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 15.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.2649965286254883
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (15, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (15, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (15, 1), h: (15, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (15, 1), h: (15, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (15, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (15, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.185374, max: 0.529531
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (15, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (15, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (15, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.106071, max: 0.510804
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (60, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (60,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (15, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.518360
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.338062
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.637364
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.020458
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.264997
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 15.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.338062
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.637364
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.020458
[utils/util.py::ComputeLoss.__call__] Total loss: 11.995885
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.635821
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.993382, max: 0.629949
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6299492716789246
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0005786921828985214
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.7622737884521484
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.133779, max: 0.635821
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.049075, max: 0.629949
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.175626
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.705328
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.545458
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.637013
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.762274
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.705328
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.545458
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.637013
[utils/util.py::ComputeLoss.__call__] Total loss: 11.887800
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.671667
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.002430, max: 0.671658
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6716580986976624
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0015491986414417624
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.790795087814331
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.135690, max: 0.671667
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.108380, max: 0.671658
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.478333
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.046537
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.906629
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.704148
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.790795
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.046537
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.906629
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.704148
[utils/util.py::ComputeLoss.__call__] Total loss: 9.657314
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.678232
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.014438, max: 0.668810
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6688104867935181
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.003941231872886419
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.487470865249634
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.183462, max: 0.678232
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.085089, max: 0.668810
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.643782
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.896847
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.912269
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.677992
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.487471
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.896847
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.912269
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.677992
[utils/util.py::ComputeLoss.__call__] Total loss: 9.487108
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.517656
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.004782, max: 0.509636
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5096364617347717
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0009786130394786596
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 12
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 12.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.119408369064331
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (12, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (12, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (12, 1), h: (12, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (12, 1), h: (12, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (12, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (12, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (12, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.127110, max: 0.517656
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (12, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (12, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (12, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (12, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007417, max: 0.509636
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (48, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (48,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (12, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.516836
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.316761
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.038980
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.534091
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.119408
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 12.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.316761
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.038980
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.534091
[utils/util.py::ComputeLoss.__call__] Total loss: 9.889832
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---

[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (4, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (4, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: nan, Recall: nan, mAP50: nan, mAP: nan

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1

=== DEBUG: visualize_predictions input shapes (vis_count=0) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.322/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[ 0.        0.       18.       17.31     24.       23.380001]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=1) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.341/0.761
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       245.35      19.5       21.289993  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=2) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.396/0.792
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       127.97      43.38      26.070007  27.54    ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=3) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.227/0.800
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       243.62      25.5       22.440002  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=4) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.027/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       235.        44.67      20.669998  21.330002]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (1, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (1, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: nan, Recall: nan, mAP50: nan, mAP: nan

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.2275508  0.8917953  0.10328291 0.19888163]]

--- [main_keras.py::data_generator] DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::data_generator] Sample shape: (128, 256, 3)
[main_keras.py::data_generator] Target shape: (0, 6)
[main_keras.py::data_generator] Shapes from dataset: [[0. 0.]
 [0. 0.]
 [0. 0.]]
[main_keras.py::data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::data_generator] Shapes dtype: float32
[main_keras.py::data_generator] Shapes shape: (3, 2)
[main_keras.py::data_generator] Original size: [0.0, 0.0]
[main_keras.py::data_generator] Ratio/Padding: [0.0, 0.0]
[main_keras.py::data_generator] Target shape: (2, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.5986786  0.6519147  0.07996231 0.17148083]
 [0.         0.         0.98392165 0.6854653  0.0321489  0.1789366 ]]
[main_keras.py::data_generator] Batch samples shape: (4, 128, 256, 3)
[main_keras.py::data_generator] Batch targets shape: (3, 6)
[main_keras.py::data_generator] Batch shapes shape: (4, 3, 2)
[main_keras.py::data_generator] Target shape: (1, 6)
[main_keras.py::data_generator] Target sample: [[0.         0.         0.54520684 0.44142708 0.12155855 0.25165135]]

--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.722055
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.000246, max: 0.718765
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7187645435333252
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0024175525177270174
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 17
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.1637747287750244
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (17, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (17, 1), h: (17, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.128451, max: 0.722055
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (17, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (17, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.011483, max: 0.718765
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (68, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (68,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (17, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.708038
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.206250
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.522647
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.760021
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.163775
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 17.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.206250
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.522647
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.760021
[utils/util.py::ComputeLoss.__call__] Total loss: 9.488918
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.638709
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.988142, max: 0.629657
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6296571493148804
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 3.187037509633228e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 35
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.580610990524292
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.126661, max: 0.638709
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.008727, max: 0.629657
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.649944
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.997452
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 2.359046
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.456724
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.580611
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.997452
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 2.359046
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.456724
[utils/util.py::ComputeLoss.__call__] Total loss: 7.813222
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.709914
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.982637, max: 0.705967
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7059673070907593
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.0936120563419536e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.4760565757751465
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (25, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (25, 1), h: (25, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.140724, max: 0.709914
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (25, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (25, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.029505, max: 0.705967
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (100, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (100,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (25, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.392404
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 6.940315
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.167524
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.960904
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.476057
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 6.940315
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.167524
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.960904
[utils/util.py::ComputeLoss.__call__] Total loss: 13.068744
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.664146
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.015397, max: 0.659015
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6590145826339722
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0027398390229791403
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.864520788192749
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.083400, max: 0.664146
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.003493, max: 0.659015
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.673583
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.673193
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.608840
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.830810
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.864521
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.673193
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.608840
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.830810
[utils/util.py::ComputeLoss.__call__] Total loss: 11.112844
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.518896
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.961220, max: 0.513399
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5133992433547974
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0004721730947494507
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 40
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.9163775444030762
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.058532, max: 0.518896
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.094025, max: 0.513399
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.970702
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.989754
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.515526
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.925547
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.916378
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.989754
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.515526
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.925547
[utils/util.py::ComputeLoss.__call__] Total loss: 10.430826
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.747440
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.039417, max: 0.741020
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7410203814506531
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005393972620368004
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.4801132678985596
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.129623, max: 0.747440
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.013591, max: 0.741020
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.109163
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.542525
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.267574
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.498548
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.480113
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.542525
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.267574
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.498548
[utils/util.py::ComputeLoss.__call__] Total loss: 10.308647
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.604306
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.037327, max: 0.600035
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6000350713729858
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0020365333184599876
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.3235368728637695
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.117160, max: 0.405026
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.010433, max: 0.380406
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.527820
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.949710
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 5.417542
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.920943
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.323537
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.949710
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 5.417542
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.920943
[utils/util.py::ComputeLoss.__call__] Total loss: 11.288196
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.713180
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.027225, max: 0.706437
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7064365148544312
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0007164159324020147
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 39
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.496913909912109
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (37, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (37, 1), h: (37, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.121248, max: 0.713180
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (37, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (37, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.062055, max: 0.706436
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (148, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (148,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (37, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.740639
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.614834
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.732979
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.611221
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.496914
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.614834
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.732979
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.611221
[utils/util.py::ComputeLoss.__call__] Total loss: 9.959035
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.755511
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.025134, max: 0.750357
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7503565549850464
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.006838995032012463
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 24
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.7248282432556152
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.161250, max: 0.755511
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.057854, max: 0.750357
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.323323
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.742671
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.280099
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.340254
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.724828
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.742671
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.280099
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.340254
[utils/util.py::ComputeLoss.__call__] Total loss: 8.363024
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.729364
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.017682, max: 0.724322
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7243215441703796
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0068550677970051765
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 30
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.268628120422363
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.124724, max: 0.729364
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.006282, max: 0.724322
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.473031
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.552461
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.863768
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.385048
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.268628
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.552461
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.863768
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.385048
[utils/util.py::ComputeLoss.__call__] Total loss: 8.801276
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.657625
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.022199, max: 0.649230
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.649229884147644
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004722436890006065
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.380169630050659
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.128088, max: 0.657625
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.010630, max: 0.649230
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.784533
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.749918
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.236608
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.318064
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.380170
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.749918
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.236608
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.318064
[utils/util.py::ComputeLoss.__call__] Total loss: 8.304590
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.540993
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.027601, max: 0.536600
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5366004705429077
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0006479626172222197
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 36
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 29.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.3054237365722656
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (29, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (29, 1), h: (29, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.151703, max: 0.540993
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (29, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (29, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.047202, max: 0.536600
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (116, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (116,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (29, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.149687
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.881660
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.154606
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.318339
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.305424
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 29.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.881660
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.154606
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.318339
[utils/util.py::ComputeLoss.__call__] Total loss: 10.354606
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (12, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 12, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 12, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 12, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 12
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 12)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 12, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 12, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 12, 1, 1), h: (4, 12, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.638361
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 12, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.985980, max: 0.627487
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6274866461753845
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0015581538900732994
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 12, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 12, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 12, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 12, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 45.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 43.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 7.287187099456787
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (43, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (43, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (43, 1), h: (43, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (43, 1), h: (43, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (43, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (43, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (43, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.154664, max: 0.638361
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (43, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (43, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (43, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (43, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051119, max: 0.627487
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (172, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (172,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (43, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.679538
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.779701
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.150690
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.718549
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 7.287187
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 43.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.779701
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.150690
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.718549
[utils/util.py::ComputeLoss.__call__] Total loss: 9.648941
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (1, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 1, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 1
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 1)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 1, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 1, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 1, 1, 1), h: (4, 1, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.362945
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.974262, max: 0.362128
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.36212846636772156
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 8.420838275924325e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 16
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 1, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 1, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8731157779693604
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.190913, max: 0.362945
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.100725, max: 0.362128
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (40, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (40,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (10, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.981312
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.707591
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.419111
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 3.310609
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.873116
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.707591
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.419111
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 3.310609
[utils/util.py::ComputeLoss.__call__] Total loss: 12.437311
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.669861
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.967466, max: 0.665896
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6658962368965149
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0006990095134824514
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 46
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.400306701660156
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (38, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (38, 1), h: (38, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.184788, max: 0.669861
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (38, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (38, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.088182, max: 0.665896
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (152, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (152,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (38, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.093406
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.881879
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.646270
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.224776
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.400307
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 38.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.881879
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.646270
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.224776
[utils/util.py::ComputeLoss.__call__] Total loss: 10.752925
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.698362
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.964387, max: 0.695570
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6955696940422058
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0009383891592733562
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 22
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.15352463722229
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (20, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (20, 1), h: (20, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.126139, max: 0.698362
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (20, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (20, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007813, max: 0.695570
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (80, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (80,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (20, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.077967
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.958408
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.431963
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.805891
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.153525
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.958408
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.431963
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.805891
[utils/util.py::ComputeLoss.__call__] Total loss: 11.196262
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (2, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 2, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 2
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 2)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 2, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 2, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 2, 1, 1), h: (4, 2, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.356011
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 2, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.985225, max: 0.354794
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.3547937273979187
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 2.560619032010436e-05
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 6
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 2, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 2, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 6.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 0.8958418369293213
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (6, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (6, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (6, 1), h: (6, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (6, 1), h: (6, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (6, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (6, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (6, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.155732, max: 0.356011
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (6, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (6, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (6, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (6, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.055060, max: 0.354794
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (24, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (24,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (6, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.574841
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.068536
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.629259
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.718475
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 0.895842
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 6.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.068536
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.629259
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.718475
[utils/util.py::ComputeLoss.__call__] Total loss: 10.416269
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.556042
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.005197, max: 0.544142
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5441415905952454
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00047952652676030993
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 8
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 7.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.1237945556640625
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (7, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (7, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (7, 1), h: (7, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (7, 1), h: (7, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (7, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (7, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (7, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.161770, max: 0.556042
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (7, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (7, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (7, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (7, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.089547, max: 0.544142
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (28, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (28,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (7, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.401048
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.502488
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.448803
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.559370
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.123795
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 7.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.502488
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.448803
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.559370
[utils/util.py::ComputeLoss.__call__] Total loss: 10.510661
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.556681
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.992321, max: 0.556167
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5561665892601013
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0004657651297748089
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 37
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.662858009338379
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.174786, max: 0.556681
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.078237, max: 0.556167
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.592055
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.169304
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.343068
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.652356
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.662858
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.169304
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.343068
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.652356
[utils/util.py::ComputeLoss.__call__] Total loss: 10.164728
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.655352
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.023695, max: 0.651888
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.651888370513916
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0019416422583162785
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 43
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.886563777923584
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.159836, max: 0.655352
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.050774, max: 0.651888
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 3.055989
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 5.801720
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.322981
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.795150
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.886564
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 5.801720
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.322981
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.795150
[utils/util.py::ComputeLoss.__call__] Total loss: 12.919851
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.731945
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.017185, max: 0.724725
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7247250080108643
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00675545446574688
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 25
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 25.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.9942827224731445
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.134285, max: 0.731945
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.020984, max: 0.724725
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.553377
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.791813
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.044796
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.705031
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.994283
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.791813
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.044796
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.705031
[utils/util.py::ComputeLoss.__call__] Total loss: 9.541641
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.762735
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.017448, max: 0.758385
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7583849430084229
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.008529460057616234
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 27
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.06563138961792
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.156586, max: 0.762735
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051802, max: 0.758385
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.344473
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.455312
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.631396
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.397916
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.065631
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.455312
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.631396
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.397916
[utils/util.py::ComputeLoss.__call__] Total loss: 8.484625
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.585222
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.008227, max: 0.576652
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.576652467250824
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0026292591355741024
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.5640816688537598
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.125968, max: 0.585222
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.008541, max: 0.576653
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.897380
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.913279
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.687022
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.900765
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.564082
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.913279
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.687022
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.900765
[utils/util.py::ComputeLoss.__call__] Total loss: 9.501065
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (11, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 11, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 11, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 11, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 11
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 11)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 11, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 11, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 11, 1, 1), h: (4, 11, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.736585
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 11, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.986818, max: 0.736539
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7365388870239258
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.005424397997558117
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 11, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 11, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 11, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 11, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 33.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 32.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.726621627807617
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (32, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (32, 1), h: (32, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.134317, max: 0.736585
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (32, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (32, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.023273, max: 0.736539
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (128, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (128,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (32, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.595201
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.962348
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.074883
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.690737
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.726622
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 32.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.962348
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.074883
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.690737
[utils/util.py::ComputeLoss.__call__] Total loss: 9.727968
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.574968
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.057595, max: 0.571977
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5719774961471558
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0015691029839217663
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 34
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 24.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.977649688720703
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (24, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (24, 1), h: (24, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.165192, max: 0.574968
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (24, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (24, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.031420, max: 0.571977
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (96, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (96,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (24, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.633715
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.624121
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.144088
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.963537
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.977650
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 24.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.624121
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.144088
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.963537
[utils/util.py::ComputeLoss.__call__] Total loss: 9.731745
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.725521
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.964946, max: 0.724382
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7243818044662476
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.006141741294413805
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 47
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.503530979156494
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.206969, max: 0.725521
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.121103, max: 0.724382
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.718979
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.565003
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.084889
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.763934
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.503531
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.565003
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.084889
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.763934
[utils/util.py::ComputeLoss.__call__] Total loss: 8.413826
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.835469
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.052083, max: 0.835133
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.8351327180862427
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.01535841729491949
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 47
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.401590824127197
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (39, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (39, 1), h: (39, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.227822, max: 0.835469
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (39, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (39, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.134960, max: 0.835133
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (156, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (156,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (39, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.606095
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.460652
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.404850
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.645634
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.401591
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 39.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.460652
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.404850
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.645634
[utils/util.py::ComputeLoss.__call__] Total loss: 8.511135
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.794392
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.944210, max: 0.791904
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7919041514396667
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.012053328566253185
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 38
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.273194313049316
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (36, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (36, 1), h: (36, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.101566, max: 0.794392
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (36, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (36, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007353, max: 0.791904
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (144, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (144,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (36, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.604834
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.576764
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.676410
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.667993
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.273194
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 36.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.576764
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.676410
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.667993
[utils/util.py::ComputeLoss.__call__] Total loss: 8.921168
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.758788
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.951540, max: 0.757043
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7570428252220154
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.010268128477036953
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 23
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 19.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.579519510269165
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (19, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (19, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (19, 1), h: (19, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (19, 1), h: (19, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (19, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (19, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (19, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.164043, max: 0.758788
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (19, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (19, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (19, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (19, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.063471, max: 0.757043
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (76, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (76,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (19, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.411388
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.738582
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.129564
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.399253
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.579520
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 19.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.738582
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.129564
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.399253
[utils/util.py::ComputeLoss.__call__] Total loss: 8.267399
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.688637
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.991900, max: 0.680813
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6808133721351624
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0048229084350168705
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 33
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.6774754524230957
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (28, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (28, 1), h: (28, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.156459, max: 0.688637
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (28, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (28, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.051756, max: 0.680813
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (112, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (112,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (28, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.989700
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.603079
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.317225
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.776289
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.677475
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.603079
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.317225
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.776289
[utils/util.py::ComputeLoss.__call__] Total loss: 8.696593
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.593803
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.017874, max: 0.584099
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5840993523597717
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0017528480384498835
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 20
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.7039244174957275
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (18, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (18, 1), h: (18, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.135850, max: 0.593803
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (18, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (18, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.009649, max: 0.584099
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (72, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (72,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (18, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.825903
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.783291
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.303232
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.928982
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.703924
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 18.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.783291
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.303232
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.928982
[utils/util.py::ComputeLoss.__call__] Total loss: 10.015505
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.562145
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.019629, max: 0.556634
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.556633710861206
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0011148840421810746
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 20.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 14.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.7505792379379272
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (14, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (14, 1), h: (14, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.194794, max: 0.562145
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (14, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (14, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.109676, max: 0.556634
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (56, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (56,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (14, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.954140
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.013741
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.184623
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.069336
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.750579
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 14.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.013741
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.184623
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.069336
[utils/util.py::ComputeLoss.__call__] Total loss: 10.267700
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.660427
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.994588, max: 0.648825
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6488247513771057
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002161701675504446
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 28
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 28.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 27.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.191336631774902
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (27, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (27, 1), h: (27, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.138909, max: 0.660427
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (27, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (27, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.026175, max: 0.648825
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (108, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (108,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (27, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.582133
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.760110
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.268720
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.419624
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.191337
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 27.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.760110
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.268720
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.419624
[utils/util.py::ComputeLoss.__call__] Total loss: 8.448454
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (5, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 5, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 5
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 5)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 5, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 5, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 5, 1, 1), h: (4, 5, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.646450
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 5, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.044039, max: 0.635605
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6356052756309509
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002050971845164895
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 49
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 5, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 5, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.327791213989258
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (35, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (35, 1), h: (35, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.153735, max: 0.646450
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (35, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (35, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.030283, max: 0.635605
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (140, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (140,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (35, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.927760
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.677855
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.977486
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.128701
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.327791
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 35.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.677855
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.977486
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.128701
[utils/util.py::ComputeLoss.__call__] Total loss: 9.784042
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.610161
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.031604, max: 0.596835
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.5968354940414429
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0017800265923142433
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 31
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 6.11473274230957
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (31, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (31, 1), h: (31, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.126055, max: 0.610161
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (31, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (31, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.007139, max: 0.596835
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (124, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (124,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (31, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.560973
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.455536
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.612012
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.858332
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 6.114733
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 31.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.455536
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.612012
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.858332
[utils/util.py::ComputeLoss.__call__] Total loss: 9.925879
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (8, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 8, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 8
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 8)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 8, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 8, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 8, 1, 1), h: (4, 8, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.705383
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 8, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.049183, max: 0.702023
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7020227909088135
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.006432976573705673
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 26
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 8, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 8, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 3.772634744644165
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (26, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (26, 1), h: (26, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.123418, max: 0.705383
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (26, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (26, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.031235, max: 0.702023
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (104, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (104,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (26, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.543521
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.546695
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.960949
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.603430
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 3.772635
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 26.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.546695
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.960949
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.603430
[utils/util.py::ComputeLoss.__call__] Total loss: 9.111074
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (6, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 6, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 6
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 6)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 6, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 6, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 6, 1, 1), h: (4, 6, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.644815
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 6, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.047965, max: 0.633539
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6335389018058777
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0034138329792767763
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 32
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 6, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 6, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.458456516265869
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (30, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (30, 1), h: (30, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.163576, max: 0.644815
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (30, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (30, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.063274, max: 0.633539
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (120, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (120,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (30, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.527194
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.543189
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.805865
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.467590
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.458457
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 30.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.543189
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.805865
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.467590
[utils/util.py::ComputeLoss.__call__] Total loss: 8.816645
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.606028
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.053429, max: 0.601716
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.601715624332428
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.002521080896258354
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 49
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 42.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 41.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.7213454246521
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (41, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (41, 1), h: (41, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.132905, max: 0.606028
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (41, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (41, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.022619, max: 0.601716
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (164, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (164,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (41, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.788346
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.521126
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.302582
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.948161
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.721345
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 41.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.521126
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.302582
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.948161
[utils/util.py::ComputeLoss.__call__] Total loss: 9.771870
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.618251
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.999144, max: 0.611063
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.61106276512146
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0025914509315043688
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 10
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 1.2829830646514893
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (10, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (10, 1), h: (10, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.192183, max: 0.618251
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (10, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (10, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.102337, max: 0.611063
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (40, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (40,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (10, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.347220
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.875577
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.369054
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.150448
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 1.282983
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 10.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.875577
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.369054
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.150448
[utils/util.py::ComputeLoss.__call__] Total loss: 9.395079
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (4, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 4, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 4
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 4)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 4, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 4, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 4, 1, 1), h: (4, 4, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.782197
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 4, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.999981, max: 0.777111
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.7771105766296387
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.004856744781136513
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 22
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 4, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.638432025909424
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (22, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (22, 1), h: (22, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.141985, max: 0.782197
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (22, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (22, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.032098, max: 0.777111
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (88, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (88,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (22, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.717456
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.990773
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.096599
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.322602
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.638432
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 22.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.990773
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.096599
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.322602
[utils/util.py::ComputeLoss.__call__] Total loss: 8.409975
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (9, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 9, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 9
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 9)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 9, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 9, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 9, 1, 1), h: (4, 9, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.678726
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 9, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.980665, max: 0.673609
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.673608660697937
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.0019872740376740694
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 60
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 9, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 9, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 53.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 5.758084297180176
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (53, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (53, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (53, 1), h: (53, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (53, 1), h: (53, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (53, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (53, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (53, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.113100, max: 0.678726
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (53, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (53, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (53, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (53, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.028236, max: 0.673609
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (212, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (212,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (53, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.165366
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 4.091166
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.102830
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.880949
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 5.758084
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 53.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 4.091166
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.102830
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.880949
[utils/util.py::ComputeLoss.__call__] Total loss: 10.074945
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (3, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 3, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 3
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 3)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 3, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 3, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 3, 1, 1), h: (4, 3, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.442634
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 3, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -1.042430, max: 0.437545
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.4375446140766144
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.00017303269123658538
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 29
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 3, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 3, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 2.4736037254333496
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (23, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (23, 1), h: (23, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.183285, max: 0.442634
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (23, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (23, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.091459, max: 0.437545
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (92, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (92,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (23, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 2.251535
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.928235
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 4.939987
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 2.769247
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 2.473604
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 23.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.928235
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 4.939987
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 2.769247
[utils/util.py::ComputeLoss.__call__] Total loss: 11.637468
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] KERAS LOSS COMPUTATION DEBUG ---
[utils/util.py::ComputeLoss.__call__] Number of output tensors: 1
[utils/util.py::ComputeLoss.__call__] Output 0 shape: (4, 16, 32, 65)
[utils/util.py::ComputeLoss.__call__] Concatenated output shape: (4, 65, 512)
[utils/util.py::ComputeLoss.__call__] pred_output shape: (4, 64, 512)
[utils/util.py::ComputeLoss.__call__] pred_scores shape: (4, 1, 512)
[utils/util.py::ComputeLoss.__call__] After permute - pred_output shape: (4, 512, 64)
[utils/util.py::ComputeLoss.__call__] After permute - pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Size tensor: [128. 256.]
[utils/util.py::ComputeLoss.__call__] Anchor points shape: (512, 2)
[utils/util.py::ComputeLoss.__call__] Stride tensor shape: (512, 1)

--- [utils/util.py::ComputeLoss.__call__] TARGET PROCESSING ---
[utils/util.py::ComputeLoss.__call__] Targets shape: (7, 6)
[utils/util.py::ComputeLoss.__call__] Pred output dimensions - b: 4, a: 512, c: 64
[utils/util.py::ComputeLoss.__call__] Pred bboxes after softmax shape: (4, 512, 4, 16)
[utils/util.py::ComputeLoss.__call__] Pred bboxes after matmul shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Final pred bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.__call__] Scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.__call__] Bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.__call__] ASSIGNMENT PHASE ---

--- [utils/util.py::ComputeLoss.assign] KERAS ASSIGNMENT DEBUG ---
[utils/util.py::ComputeLoss.assign] pred_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)
[utils/util.py::ComputeLoss.assign] true_labels shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils.util.py::ComputeLoss.assign] true_mask shape: (4, 7, 1)
[utils/util.py::ComputeLoss.assign] anchors shape: (512, 2)
[utils/util.py::ComputeLoss.assign] Batch size: 4, Max boxes: 7
[utils/util.py::ComputeLoss.assign] Created indices tensor with shape: (2, 4, 7)

--- [utils/util.py::ComputeLoss.assign] IOUs DEBUG ---
[utils/util.py::ComputeLoss.assign] true_bboxes shape: (4, 7, 4)
[utils/util.py::ComputeLoss.assign] pred_bboxes shape: (4, 512, 4)

--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (4, 7, 1, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (4, 1, 512, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (4, 7, 1, 1), h: (4, 7, 1, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (4, 1, 512, 1), h: (4, 1, 512, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.000000, max: 0.694234
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (4, 7, 512, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: -0.972130, max: 0.686753
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---

[utils/util.py::ComputeLoss.assign] overlaps shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] overlaps min: 0.0, max: 0.6867525577545166
[utils/util.py::ComputeLoss.assign] align_metric shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] align_metric min: 0.0, max: 0.003190819174051285
[utils/util.py::ComputeLoss.assign] mask_in_gts shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_in_gts sum: 39
[utils/util.py::ComputeLoss.assign] metrics shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] top_k_mask shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_metrics shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] top_k_indices shape: (4, 7, 10)
[utils/util.py::ComputeLoss.assign] is_in_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_top_k shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] mask_pos shape: (4, 7, 512)
[utils/util.py::ComputeLoss.assign] fg_mask shape: (4, 512)
[utils/util.py::ComputeLoss.assign] fg_mask sum: 37.0
[utils/util.py::ComputeLoss.assign] Detected anchors assigned to multiple GT boxes
[utils/util.py::ComputeLoss.assign] After resolving multiple assignments - fg_mask sum: 34.0
[utils/util.py::ComputeLoss.assign] target_gt_idx shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_labels shape: (4, 512)
[utils/util.py::ComputeLoss.assign] target_bboxes shape: (4, 512, 4)
[utils/util_keras.py::ComputeLoss.assign] self.nc: 1
[utils/util_keras.py::ComputeLoss.assign] target_scores shape: (4, 512, 1)
[utils/util_keras.py::ComputeLoss.assign] Normalized target_scores shape: (4, 512, 1)
[utils/util.py::ComputeLoss.assign] target_scores sum: 4.837097644805908
--- [utils/util.py::ComputeLoss.assign] END KERAS ASSIGNMENT DEBUG ---


--- [utils/util.py::ComputeLoss.iou] KERAS IOU DEBUG ---
[utils/util.py::ComputeLoss.iou] box1 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] box2 shape: (34, 4)
[utils/util.py::ComputeLoss.iou] Box1 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Box2 dimensions - w: (34, 1), h: (34, 1)
[utils/util.py::ComputeLoss.iou] Intersection shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Union shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] IoU min: 0.171987, max: 0.694234
[utils/util.py::ComputeLoss.iou] Convex diagonal squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Center distance squared shape: (34, 1)
[utils/util.py::ComputeLoss.iou] Aspect ratio term shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU shape: (34, 1)
[utils/util.py::ComputeLoss.iou] CIoU min: 0.073164, max: 0.686753
--- [utils/util.py::ComputeLoss.iou] END KERAS IOU DEBUG ---


--- [utils/util_keras.py::ComputeLoss.df_loss] KERAS DFL LOSS DEBUG ---
[utils/util_keras.py::ComputeLoss.df_loss] pred_dist shape: (136, 16), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] target shape: (136,), dtype: <dtype: 'float32'>
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss shape: (34, 1)
[utils/util_keras.py::ComputeLoss.df_loss] DFL loss mean: 1.554284
--- [utils/util_keras.py::ComputeLoss.df_loss] END KERAS DFL LOSS DEBUG ---


--- [utils/util.py::ComputeLoss.__call__] LOSS COMPONENTS DEBUG ---
[utils/util.py::ComputeLoss.__call__] Raw loss_cls: 3.697518
[utils/util.py::ComputeLoss.__call__] Raw loss_box: 3.814416
[utils/util.py::ComputeLoss.__call__] Raw loss_dfl: 1.489178
[utils/util.py::ComputeLoss.__call__] Loss weights - cls: 0.5, box: 7.5, dfl: 1.5
[utils/util.py::ComputeLoss.__call__] target_scores_sum: 4.837098
[utils/util.py::ComputeLoss.__call__] fg_mask sum: 34.0
[utils/util.py::ComputeLoss.__call__] Weighted loss_cls: 3.697518
[utils/util.py::ComputeLoss.__call__] Weighted loss_box: 3.814416
[utils/util.py::ComputeLoss.__call__] Weighted loss_dfl: 1.489178
[utils/util.py::ComputeLoss.__call__] Total loss: 9.001112
--- [utils/util.py::ComputeLoss.__call__] END KERAS LOSS COMPUTATION DEBUG ---

[nets/tinysimov35_keras.initialize_biases] Box bias initialized
[nets/tinysimov35_keras.initialize_biases] Cls bias initialized
[nets/tinysimov35_keras.YOLO.__init__] Box bias mean: 1.0
[nets/tinysimov35_keras.YOLO.__init__] Cls bias mean: -7.15461540222168
[nets/tinysimov35_keras.YOLO.__init__] Initial logits min/max: 0.0000/252.0000

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (4, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (4, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: nan, Recall: nan, mAP50: nan, mAP: nan

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 0) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 1) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 2) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 3) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0

--- [main_keras.py::test_data_generator] TEST DATASET OUTPUT DEBUG (sample 4) ---
[main_keras.py::test_data_generator] Sample shape: (128, 256, 3)
[main_keras.py::test_data_generator] Target shape: (1, 6)
[main_keras.py::test_data_generator] Shapes from dataset: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
[main_keras.py::test_data_generator] Shapes type: <class 'numpy.ndarray'>
[main_keras.py::test_data_generator] Shapes dtype: float32
[main_keras.py::test_data_generator] Shapes shape: (3, 2)
[main_keras.py::test_data_generator] Original size: [128.0, 256.0]
[main_keras.py::test_data_generator] Ratio/Padding: [1.0, 1.0]
[main_keras.py::test_data_generator] Padded target shape: (100, 6)
[main_keras.py::test_data_generator] Non-zero targets: 0
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1

=== DEBUG: visualize_predictions input shapes (vis_count=0) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.322/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[ 0.        0.       18.       17.31     24.       23.380001]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=1) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.341/0.761
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       245.35      19.5       21.289993  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=2) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.396/0.792
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       127.97      43.38      26.070007  27.54    ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=3) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.227/0.800
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       243.62      25.5       22.440002  23.      ]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===

=== DEBUG: visualize_predictions input shapes (vis_count=4) ===
single_sample shape: (1, 128, 256, 3)
single_sample dtype: <dtype: 'float32'>
single_sample min/max: 0.027/0.749
single_out type: <class 'list'>
single_out length: 1
single_out[0] shape: (0, 6)
single_out[0] dtype: <dtype: 'float32'>
single_out[0]: empty tensor
single_gt shape: (1, 6)
single_gt dtype: <dtype: 'float32'>
single_gt content (first few):
tf.Tensor([[  0.         0.       235.        44.67      20.669998  21.330002]], shape=(1, 6), dtype=float32)
single_shapes: [[[128. 256.]
  [  1.   1.]
  [  0.   0.]]]
shapes shape: (8, 3, 2)
single_shapes type: <class 'tensorflow.python.framework.ops.EagerTensor'>
single_shapes dtype: <dtype: 'float32'>
single_shapes shape: (1, 3, 2)
single_shapes[0]: [[128. 256.]
 [  1.   1.]
 [  0.   0.]]
single_shapes[0] original size: [128.0, 256.0]
single_shapes[0] ratio/padding: [1.0, 1.0]
=== END DEBUG ===
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (8, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (8, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
[main_keras.py::test] Model outputs shape: (1, 512, 5)

--- [utils/util_keras.py::non_max_suppression] KERAS NMS DEBUG ---
[utils/util_keras.py::non_max_suppression] Prediction shape: (1, 512, 5)
[utils/util_keras.py::non_max_suppression] Conf threshold: 0.25, IoU threshold: 0.45
[utils/util_keras.py::non_max_suppression] Number of classes: 1
Precision: nan, Recall: nan, mAP50: nan, mAP: nan
